<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarrakFit ‚Äì Votre coach calories & macros made in Morocco</title>
    <style>
        :root {
            --primary-color: #C1272D; /* Rouge Marrakech */
            --primary-dark: #A02025;
            --primary-light: #E8B4B6;
            --secondary-color: #D4AF37; /* Or marocain */
            --secondary-dark: #B8941F;
            --secondary-light: #F4E4A9;
            --accent-color: #228B22; /* Vert palmier */
            --text-color: #2F2F2F;
            --text-light: #666;
            --background-color: #FDF6E3; /* Beige sable */
            --card-background: #FFFFFF;
            --border-color: #E0D6C3;
            --error-color: #C1272D;
            --success-color: #228B22;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
            min-height: 100vh;
            position: relative;
            transition: all 0.3s ease;
        }

        /* Arri√®re-plan avec palmiers */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path d="M50,10 C60,20 65,30 60,40 C55,50 45,55 50,65 C55,75 60,80 50,90 C40,80 45,75 50,65 C55,55 45,50 40,40 C35,30 40,20 50,10 Z" fill="%23228B22" opacity="0.1"/></svg>');
            background-size: 200px;
            opacity: 0.3;
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }

        .language-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .language-btn:hover {
            background: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .language-options {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            padding: 10px 0;
            margin-top: 5px;
            display: none;
            min-width: 150px;
        }

        .language-options.show {
            display: block;
        }

        .language-option {
            padding: 8px 15px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .language-option:hover {
            background: var(--primary-light);
        }

        header {
            text-align: center;
            padding: 30px 0;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        /* Motif marocain d√©coratif */
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path d="M50,10 C60,20 65,30 60,40 C55,50 45,55 50,65 C55,75 60,80 50,90 C40,80 45,75 50,65 C55,55 45,50 40,40 C35,30 40,20 50,10 Z" fill="white" opacity="0.1"/></svg>');
            background-size: 150px;
            opacity: 0.2;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .section {
            background-color: var(--card-background);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
            border: 1px solid var(--border-color);
            position: relative;
        }

        .section:hover {
            transform: translateY(-5px);
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--primary-dark);
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: "‚ú¶";
            color: var(--secondary-color);
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
            transition: border 0.3s;
            background-color: #FFF;
        }

        input:focus, select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(193, 39, 45, 0.2);
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .radio-option input {
            width: auto;
        }

        button {
            cursor: pointer;
            border: none;
            border-radius: 5px;
            padding: 12px 20px;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(193, 39, 45, 0.3);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: var(--secondary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(212, 175, 55, 0.3);
        }

        .btn-large {
            font-size: 1.2rem;
            padding: 20px 30px;
            width: 100%;
            margin-bottom: 20px;
        }

        .result-card {
            background: linear-gradient(135deg, #FDF6E3, #F4E4A9);
            border-left: 5px solid var(--primary-color);
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .result-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--primary-dark);
        }

        .result-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .hidden {
            display: none;
        }

        .progress-bar {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }

        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            z-index: 2;
            transition: all 0.3s ease;
        }

        .step.active {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 2px 5px rgba(193, 39, 45, 0.3);
        }

        .step.completed {
            background-color: var(--success-color);
            color: white;
        }

        .step-indicator::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            height: 2px;
            background-color: #e0e0e0;
            z-index: 1;
        }

        .plan-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .plan-table th, .plan-table td {
            border: 1px solid var(--border-color);
            padding: 8px;
            text-align: left;
        }

        .plan-table th {
            background-color: var(--primary-light);
            font-weight: bold;
        }

        .plan-table .meal-header {
            background-color: var(--secondary-light);
            font-weight: bold;
            font-size: 1.1em;
        }

        .plan-table .meal-total-row {
            background-color: #e8f5e9;
            font-weight: bold;
        }

        .plan-table .daily-total-row {
            background-color: var(--primary-light);
            font-weight: bold;
            font-size: 1.1em;
        }

        .home-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .home-option {
            background: white;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .home-option:hover {
            transform: translateY(-5px);
        }

        .home-option h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--primary-dark);
        }

        .home-option p {
            margin-bottom: 20px;
            color: var(--text-light);
        }

        .history-list {
            margin-top: 20px;
        }

        .history-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .history-item h4 {
            font-size: 1.2rem;
            margin-bottom: 5px;
            color: var(--primary-dark);
        }

        .history-item p {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .empty-history {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
        }

        .empty-history p {
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .radio-group {
                flex-direction: column;
                gap: 10px;
            }
            
            header h1 {
                font-size: 2rem;
            }
            
            .language-selector {
                position: relative;
                top: 0;
                right: 0;
                margin-bottom: 20px;
                display: flex;
                justify-content: center;
            }
            
            .plan-table {
                font-size: 0.8rem;
            }
            
            .plan-table th, .plan-table td {
                padding: 5px;
            }
            
            .home-options {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .plan-table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- S√©lecteur de langue -->
        <div class="language-selector">
            <div class="language-btn" id="languageBtn">
                <span>üåê</span>
                <span id="currentLanguage">Fran√ßais</span>
                <span>‚ñº</span>
            </div>
            <div class="language-options" id="languageOptions">
                <div class="language-option" data-lang="fr">Fran√ßais</div>
                <div class="language-option" data-lang="en">English</div>
                <div class="language-option" data-lang="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</div>
            </div>
        </div>

        <header>
            <h1 id="appTitle">MarrakFit ‚Äì Votre coach calories & macros made in Morocco</h1>
            <p id="appSubtitle">Obtenez votre plan alimentaire personnalis√© selon vos objectifs</p>
        </header>

        <div class="app-container">
            <!-- Page d'accueil -->
            <section id="homeSection" class="section">
                <h2 class="section-title">Bienvenue sur MarrakFit</h2>
                <p>Choisissez une option pour commencer :</p>
                
                <div class="home-options">
                    <div class="home-option">
                        <h3>Nouveau plan</h3>
                        <p>Cr√©ez un nouveau plan nutritionnel personnalis√© selon vos objectifs</p>
                        <button id="newPlanBtn" class="btn-primary btn-large">Cr√©er un nouveau plan</button>
                    </div>
                    
                    <div class="home-option">
                        <h3>Historique</h3>
                        <p>Consultez vos plans pr√©c√©demment cr√©√©s</p>
                        <button id="historyBtn" class="btn-secondary btn-large">Voir l'historique</button>
                    </div>
                </div>
            </section>

            <!-- Section Historique -->
            <section id="historySection" class="section hidden">
                <h2 class="section-title">Historique des plans</h2>
                
                <div id="historyList" class="history-list">
                    <!-- Les plans sauvegard√©s seront affich√©s ici -->
                </div>
                
                <div class="form-actions">
                    <button type="button" id="backToHomeFromHistoryBtn" class="btn-secondary">Retour √† l'accueil</button>
                </div>
            </section>

            <!-- Indicateur de progression (pour le formulaire) -->
            <div id="stepIndicator" class="step-indicator hidden">
                <div class="step active" id="step1">1</div>
                <div class="step" id="step2">2</div>
                <div class="step" id="step3">3</div>
                <div class="step" id="step4">4</div>
            </div>

            <!-- √âtape 1: Informations personnelles -->
            <section id="personalInfoSection" class="section hidden">
                <h2 class="section-title" id="personalInfoTitle">Informations Personnelles</h2>
                <form id="personalInfoForm">
                    <div class="form-group">
                        <label for="age" id="ageLabel">√Çge</label>
                        <input type="number" id="age" min="15" max="100" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="gender" id="genderLabel">Genre</label>
                        <select id="gender" required>
                            <option value="" id="genderDefault">S√©lectionnez votre genre</option>
                            <option value="male" id="genderMale">Homme</option>
                            <option value="female" id="genderFemale">Femme</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="weight" id="weightLabel">Poids (kg)</label>
                        <input type="number" id="weight" min="30" max="200" step="0.1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="height" id="heightLabel">Taille (cm)</label>
                        <input type="number" id="height" min="100" max="250" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="activityLevel" id="activityLabel">Niveau d'activit√©</label>
                        <select id="activityLevel" required>
                            <option value="" id="activityDefault">S√©lectionnez votre niveau d'activit√©</option>
                            <option value="1.2" id="activitySedentary">S√©dentaire (peu ou pas d'exercice)</option>
                            <option value="1.375" id="activityLight">L√©g√®rement actif (1-3 jours/semaine)</option>
                            <option value="1.55" id="activityModerate">Mod√©r√©ment actif (3-5 jours/semaine)</option>
                            <option value="1.725" id="activityActive">Tr√®s actif (6-7 jours/semaine)</option>
                            <option value="1.9" id="activityExtreme">Extr√™mement actif (entra√Ænement intense quotidien)</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" id="backToHomeFromFormBtn" class="btn-secondary">Retour √† l'accueil</button>
                        <button type="button" id="nextToGoalBtn" class="btn-primary">Suivant</button>
                    </div>
                </form>
            </section>

            <!-- √âtape 2: Objectif -->
            <section id="goalSection" class="section hidden">
                <h2 class="section-title" id="goalTitle">Votre Objectif</h2>
                <form id="goalForm">
                    <div class="form-group">
                        <label id="goalQuestion">Que souhaitez-vous atteindre ?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="goalMuscle" name="goal" value="muscle" required>
                                <label for="goalMuscle" id="goalMuscleLabel">Prendre du muscle</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="goalWeightLoss" name="goal" value="weightLoss">
                                <label for="goalWeightLoss" id="goalWeightLossLabel">Perdre du poids</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="goalMaintain" name="goal" value="maintain">
                                <label for="goalMaintain" id="goalMaintainLabel">Maintenir mon poids</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="intensity" id="intensityLabel">Intensit√© de l'objectif</label>
                        <select id="intensity" required>
                            <option value="" id="intensityDefault">S√©lectionnez l'intensit√©</option>
                            <option value="250" id="intensityLight">L√©ger (+/- 250 kcal)</option>
                            <option value="500" selected id="intensityModerate">Mod√©r√© (+/- 500 kcal)</option>
                            <option value="750" id="intensityIntense">Intense (+/- 750 kcal)</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" id="backToPersonalBtn" class="btn-secondary">Pr√©c√©dent</button>
                        <button type="button" id="nextToResultsBtn" class="btn-primary">Calculer mes besoins</button>
                    </div>
                </form>
            </section>

            <!-- √âtape 3: R√©sultats des calculs -->
            <section id="resultsSection" class="section hidden">
                <h2 class="section-title" id="resultsTitle">Vos Besoins Nutritionnels</h2>
                
                <div class="result-card">
                    <h3 class="result-title" id="bmrTitle">Votre m√©tabolisme de base (BMR)</h3>
                    <div class="result-value" id="bmrResult">0 calories</div>
                    <p id="bmrDescription">Calories n√©cessaires au repos pour maintenir les fonctions vitales</p>
                </div>
                
                <div class="result-card">
                    <h3 class="result-title" id="tdeeTitle">Votre d√©pense √©nerg√©tique totale (TDEE)</h3>
                    <div class="result-value" id="tdeeResult">0 calories</div>
                    <p id="tdeeDescription">Calories n√©cessaires en fonction de votre niveau d'activit√©</p>
                </div>
                
                <div class="result-card">
                    <h3 class="result-title" id="goalCaloriesTitle">Calories recommand√©es pour votre objectif</h3>
                    <div class="result-value" id="goalCaloriesResult">0 calories</div>
                    <p id="goalDescription"></p>
                </div>
                
                <div class="result-card">
                    <h3 class="result-title" id="macrosTitle">R√©partition des macronutriments</h3>
                    <div class="macronutrients">
                        <p><strong id="proteinLabel">Prot√©ines:</strong> <span id="proteinResult">0g</span> <span id="proteinInfo"></span></p>
                        <p><strong id="fatLabel">Lipides:</strong> <span id="fatResult">0g</span> <span id="fatInfo"></span></p>
                        <p><strong id="carbsLabel">Glucides:</strong> <span id="carbsResult">0g</span> <span id="carbsInfo">(reste des calories)</span></p>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" id="backToGoalBtn" class="btn-secondary">Pr√©c√©dent</button>
                    <button type="button" id="nextToPlanBtn" class="btn-primary">Voir mon plan nutritionnel</button>
                </div>
            </section>

            <!-- √âtape 4: Plan nutritionnel -->
            <section id="planSection" class="section hidden">
                <h2 class="section-title" id="planTitle">Votre Plan Nutritionnel Quotidien</h2>
                <p id="planDescription">Bas√© sur vos besoins de <span id="dailyCaloriesPlan">0</span> calories</p>
                
                <div id="planTableContainer">
                    <!-- Le tableau du plan sera g√©n√©r√© ici dynamiquement -->
                </div>
                
                <div class="form-actions">
                    <button type="button" id="backToResultsBtn" class="btn-secondary">Pr√©c√©dent</button>
                    <button type="button" id="savePlanBtn" class="btn-primary">Sauvegarder ce plan</button>
                    <button type="button" id="restartBtn" class="btn-primary">Cr√©er un nouveau plan</button>
                </div>
            </section>
        </div>
    </div>

    <script>
        // Textes multilingues
        const translations = {
            fr: {
                appTitle: "MarrakFit ‚Äì Votre coach calories & macros made in Morocco",
                appSubtitle: "Obtenez votre plan alimentaire personnalis√© selon vos objectifs",
                currentLanguage: "Fran√ßais",
                personalInfoTitle: "Informations Personnelles",
                ageLabel: "√Çge",
                genderLabel: "Genre",
                genderDefault: "S√©lectionnez votre genre",
                genderMale: "Homme",
                genderFemale: "Femme",
                weightLabel: "Poids (kg)",
                heightLabel: "Taille (cm)",
                activityLabel: "Niveau d'activit√©",
                activityDefault: "S√©lectionnez votre niveau d'activit√©",
                activitySedentary: "S√©dentaire (peu ou pas d'exercice)",
                activityLight: "L√©g√®rement actif (1-3 jours/semaine)",
                activityModerate: "Mod√©r√©ment actif (3-5 jours/semaine)",
                activityActive: "Tr√®s actif (6-7 jours/semaine)",
                activityExtreme: "Extr√™mement actif (entra√Ænement intense quotidien)",
                nextButton: "Suivant",
                goalTitle: "Votre Objectif",
                goalQuestion: "Que souhaitez-vous atteindre ?",
                goalMuscleLabel: "Prendre du muscle",
                goalWeightLossLabel: "Perdre du poids",
                goalMaintainLabel: "Maintenir mon poids",
                intensityLabel: "Intensit√© de l'objectif",
                intensityDefault: "S√©lectionnez l'intensit√©",
                intensityLight: "L√©ger (+/- 250 kcal)",
                intensityModerate: "Mod√©r√© (+/- 500 kcal)",
                intensityIntense: "Intense (+/- 750 kcal)",
                previousButton: "Pr√©c√©dent",
                calculateButton: "Calculer mes besoins",
                resultsTitle: "Vos Besoins Nutritionnels",
                bmrTitle: "Votre m√©tabolisme de base (BMR)",
                bmrDescription: "Calories n√©cessaires au repos pour maintenir les fonctions vitales",
                tdeeTitle: "Votre d√©pense √©nerg√©tique totale (TDEE)",
                tdeeDescription: "Calories n√©cessaires en fonction de votre niveau d'activit√©",
                goalCaloriesTitle: "Calories recommand√©es pour votre objectif",
                macrosTitle: "R√©partition des macronutriments",
                proteinLabel: "Prot√©ines:",
                fatLabel: "Lipides:",
                carbsLabel: "Glucides:",
                carbsInfo: "(reste des calories)",
                viewPlanButton: "Voir mon plan nutritionnel",
                planTitle: "Votre Plan Nutritionnel Quotidien",
                planDescription: "Bas√© sur vos besoins de",
                restartButton: "Cr√©er un nouveau plan",
                savePlanButton: "Sauvegarder ce plan",
                meal: "Repas",
                food: "Aliment",
                weight: "Poids",
                calories: "Calories",
                nutrition: "Apports approximatifs",
                breakfast: "Petit-d√©jeuner",
                lunch: "D√©jeuner",
                snack: "Collation",
                dinner: "D√Æner",
                total: "Total",
                dailyTotal: "Total quotidien",
                protein: "Prot√©ines",
                carbs: "Glucides",
                fat: "Lipides",
                backToHome: "Retour √† l'accueil",
                historyTitle: "Historique des plans",
                newPlan: "Nouveau plan",
                history: "Historique",
                welcome: "Bienvenue sur MarrakFit",
                chooseOption: "Choisissez une option pour commencer :",
                createNewPlan: "Cr√©ez un nouveau plan nutritionnel personnalis√© selon vos objectifs",
                viewHistory: "Consultez vos plans pr√©c√©demment cr√©√©s",
                noPlans: "Aucun plan sauvegard√© pour le moment",
                createFirstPlan: "Cr√©ez votre premier plan pour le voir appara√Ætre ici",
                planSaved: "Plan sauvegard√© avec succ√®s!",
                viewPlans: "Voir l'historique"
            },
            en: {
                appTitle: "MarrakFit ‚Äì Your calories & macros coach made in Morocco",
                appSubtitle: "Get your personalized meal plan according to your goals",
                currentLanguage: "English",
                personalInfoTitle: "Personal Information",
                ageLabel: "Age",
                genderLabel: "Gender",
                genderDefault: "Select your gender",
                genderMale: "Male",
                genderFemale: "Female",
                weightLabel: "Weight (kg)",
                heightLabel: "Height (cm)",
                activityLabel: "Activity Level",
                activityDefault: "Select your activity level",
                activitySedentary: "Sedentary (little or no exercise)",
                activityLight: "Lightly active (1-3 days/week)",
                activityModerate: "Moderately active (3-5 days/week)",
                activityActive: "Very active (6-7 days/week)",
                activityExtreme: "Extremely active (intense daily training)",
                nextButton: "Next",
                goalTitle: "Your Goal",
                goalQuestion: "What do you want to achieve?",
                goalMuscleLabel: "Gain muscle",
                goalWeightLossLabel: "Lose weight",
                goalMaintainLabel: "Maintain my weight",
                intensityLabel: "Goal intensity",
                intensityDefault: "Select the intensity",
                intensityLight: "Light (+/- 250 kcal)",
                intensityModerate: "Moderate (+/- 500 kcal)",
                intensityIntense: "Intense (+/- 750 kcal)",
                previousButton: "Previous",
                calculateButton: "Calculate my needs",
                resultsTitle: "Your Nutritional Needs",
                bmrTitle: "Your Basal Metabolic Rate (BMR)",
                bmrDescription: "Calories needed at rest to maintain vital functions",
                tdeeTitle: "Your Total Daily Energy Expenditure (TDEE)",
                tdeeDescription: "Calories needed based on your activity level",
                goalCaloriesTitle: "Recommended calories for your goal",
                macrosTitle: "Macronutrient distribution",
                proteinLabel: "Protein:",
                fatLabel: "Fat:",
                carbsLabel: "Carbs:",
                carbsInfo: "(remaining calories)",
                viewPlanButton: "View my nutrition plan",
                planTitle: "Your Daily Nutrition Plan",
                planDescription: "Based on your needs of",
                restartButton: "Create a new plan",
                savePlanButton: "Save this plan",
                meal: "Meal",
                food: "Food",
                weight: "Weight",
                calories: "Calories",
                nutrition: "Approximate intake",
                breakfast: "Breakfast",
                lunch: "Lunch",
                snack: "Snack",
                dinner: "Dinner",
                total: "Total",
                dailyTotal: "Daily total",
                protein: "Protein",
                carbs: "Carbs",
                fat: "Fat",
                backToHome: "Back to home",
                historyTitle: "Plan History",
                newPlan: "New plan",
                history: "History",
                welcome: "Welcome to MarrakFit",
                chooseOption: "Choose an option to get started:",
                createNewPlan: "Create a new personalized nutrition plan according to your goals",
                viewHistory: "View your previously created plans",
                noPlans: "No saved plans yet",
                createFirstPlan: "Create your first plan to see it appear here",
                planSaved: "Plan saved successfully!",
                viewPlans: "View history"
            },
            ar: {
                appTitle: "MarrakFit ‚Äì ŸÖÿØÿ±ÿ® ÿßŸÑÿ≥ÿπÿ±ÿßÿ™ ŸàÿßŸÑŸÖÿßŸÉÿ±Ÿà ŸÖŸÜ ÿßŸÑŸÖÿ∫ÿ±ÿ®",
                appSubtitle: "ÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ÿÆÿ∑ÿ© Ÿàÿ¨ÿ®ÿßÿ™ŸÉ ÿßŸÑÿ¥ÿÆÿµŸäÿ© ŸàŸÅŸÇŸãÿß ŸÑÿ£ŸáÿØÿßŸÅŸÉ",
                currentLanguage: "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©",
                personalInfoTitle: "ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ¥ÿÆÿµŸäÿ©",
                ageLabel: "ÿßŸÑÿπŸÖÿ±",
                genderLabel: "ÿßŸÑÿ¨ŸÜÿ≥",
                genderDefault: "ÿßÿÆÿ™ÿ± ÿ¨ŸÜÿ≥ŸÉ",
                genderMale: "ÿ∞ŸÉÿ±",
                genderFemale: "ÿ£ŸÜÿ´Ÿâ",
                weightLabel: "ÿßŸÑŸàÿ≤ŸÜ (ŸÉÿ∫)",
                heightLabel: "ÿßŸÑÿ∑ŸàŸÑ (ÿ≥ŸÖ)",
                activityLabel: "ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑŸÜÿ¥ÿßÿ∑",
                activityDefault: "ÿßÿÆÿ™ÿ± ŸÖÿ≥ÿ™ŸàŸâ ŸÜÿ¥ÿßÿ∑ŸÉ",
                activitySedentary: "ŸÇŸÑŸäŸÑ ÿßŸÑÿ≠ÿ±ŸÉÿ© (ŸÇŸÑŸäŸÑ ÿ£Ÿà ÿ®ÿØŸàŸÜ ÿ™ŸÖÿßÿ±ŸäŸÜ)",
                activityLight: "ŸÜÿ¥ÿßÿ∑ ÿÆŸÅŸäŸÅ (1-3 ÿ£ŸäÿßŸÖ/ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ)",
                activityModerate: "ŸÜÿ¥ÿßÿ∑ ŸÖÿ™Ÿàÿ≥ÿ∑ (3-5 ÿ£ŸäÿßŸÖ/ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ)",
                activityActive: "ŸÜÿ¥Ÿäÿ∑ ÿ¨ÿØŸãÿß (6-7 ÿ£ŸäÿßŸÖ/ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ)",
                activityExtreme: "ŸÜÿ¥Ÿäÿ∑ ŸÑŸÑÿ∫ÿßŸäÿ© (ÿ™ÿØÿ±Ÿäÿ® ŸÖŸÉÿ´ŸÅ ŸäŸàŸÖŸä)",
                nextButton: "ÿßŸÑÿ™ÿßŸÑŸä",
                goalTitle: "ŸáÿØŸÅŸÉ",
                goalQuestion: "ŸÖÿßÿ∞ÿß ÿ™ÿ±ŸäÿØ ÿ£ŸÜ ÿ™ÿ≠ŸÇŸÇÿü",
                goalMuscleLabel: "ÿßŸÉÿ™ÿ≥ÿßÿ® ÿßŸÑÿπÿ∂ŸÑÿßÿ™",
                goalWeightLossLabel: "ŸÅŸÇÿØÿßŸÜ ÿßŸÑŸàÿ≤ŸÜ",
                goalMaintainLabel: "ÿßŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ Ÿàÿ≤ŸÜŸä",
                intensityLabel: "ÿ¥ÿØÿ© ÿßŸÑŸáÿØŸÅ",
                intensityDefault: "ÿßÿÆÿ™ÿ± ÿßŸÑÿ¥ÿØÿ©",
                intensityLight: "ÿÆŸÅŸäŸÅ (+/- 250 ÿ≥ÿπÿ±ÿ©)",
                intensityModerate: "ŸÖÿ™Ÿàÿ≥ÿ∑ (+/- 500 ÿ≥ÿπÿ±ÿ©)",
                intensityIntense: "ŸÖŸÉÿ´ŸÅ (+/- 750 ÿ≥ÿπÿ±ÿ©)",
                previousButton: "ÿßŸÑÿ≥ÿßÿ®ŸÇ",
                calculateButton: "ÿ≠ÿ≥ÿßÿ® ÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™Ÿä",
                resultsTitle: "ÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™ŸÉ ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ©",
                bmrTitle: "ŸÖÿπÿØŸÑ ÿßŸÑÿ£Ÿäÿ∂ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä (BMR)",
                bmrDescription: "ÿßŸÑÿ≥ÿπÿ±ÿßÿ™ ÿßŸÑÿ≠ÿ±ÿßÿ±Ÿäÿ© ÿßŸÑŸÑÿßÿ≤ŸÖÿ© ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿ±ÿßÿ≠ÿ© ŸÑŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ ÿßŸÑŸàÿ∏ÿßÿ¶ŸÅ ÿßŸÑÿ≠ŸäŸàŸäÿ©",
                tdeeTitle: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßÿ≥ÿ™ŸáŸÑÿßŸÉ ÿßŸÑÿ∑ÿßŸÇÿ© ÿßŸÑŸäŸàŸÖŸä (TDEE)",
                tdeeDescription: "ÿßŸÑÿ≥ÿπÿ±ÿßÿ™ ÿßŸÑÿ≠ÿ±ÿßÿ±Ÿäÿ© ÿßŸÑŸÑÿßÿ≤ŸÖÿ© ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ŸÖÿ≥ÿ™ŸàŸâ ŸÜÿ¥ÿßÿ∑ŸÉ",
                goalCaloriesTitle: "ÿßŸÑÿ≥ÿπÿ±ÿßÿ™ ÿßŸÑÿ≠ÿ±ÿßÿ±Ÿäÿ© ÿßŸÑŸÖŸàÿµŸâ ÿ®Ÿáÿß ŸÑŸáÿØŸÅŸÉ",
                macrosTitle: "ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑŸÖÿ∫ÿ∞Ÿäÿßÿ™ ÿßŸÑŸÉÿ®ÿ±Ÿâ",
                proteinLabel: "ÿßŸÑÿ®ÿ±Ÿàÿ™ŸäŸÜ:",
                fatLabel: "ÿßŸÑÿØŸáŸàŸÜ:",
                carbsLabel: "ÿßŸÑŸÉÿ±ÿ®ŸàŸáŸäÿØÿ±ÿßÿ™:",
                carbsInfo: "(ÿßŸÑÿ≥ÿπÿ±ÿßÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸäÿ©)",
                viewPlanButton: "ÿπÿ±ÿ∂ ÿÆÿ∑ÿ™Ÿä ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ©",
                planTitle: "ÿÆÿ∑ÿ™ŸÉ ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ© ÿßŸÑŸäŸàŸÖŸäÿ©",
                planDescription: "ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™ŸÉ ŸÖŸÜ",
                restartButton: "ÿ•ŸÜÿ¥ÿßÿ° ÿÆÿ∑ÿ© ÿ¨ÿØŸäÿØÿ©",
                savePlanButton: "ÿ≠ŸÅÿ∏ Ÿáÿ∞Ÿá ÿßŸÑÿÆÿ∑ÿ©",
                meal: "ÿßŸÑŸàÿ¨ÿ®ÿ©",
                food: "ÿßŸÑÿ∑ÿπÿßŸÖ",
                weight: "ÿßŸÑŸàÿ≤ŸÜ",
                calories: "ÿßŸÑÿ≥ÿπÿ±ÿßÿ™",
                nutrition: "ÿßŸÑŸÖÿØÿÆŸàŸÑ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ®Ÿä",
                breakfast: "ÿßŸÑŸÅÿ∑Ÿàÿ±",
                lunch: "ÿßŸÑÿ∫ÿØÿßÿ°",
                snack: "Ÿàÿ¨ÿ®ÿ© ÿÆŸÅŸäŸÅÿ©",
                dinner: "ÿßŸÑÿπÿ¥ÿßÿ°",
                total: "ÿßŸÑŸÖÿ¨ŸÖŸàÿπ",
                dailyTotal: "ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸäŸàŸÖŸä",
                protein: "ÿßŸÑÿ®ÿ±Ÿàÿ™ŸäŸÜ",
                carbs: "ÿßŸÑŸÉÿ±ÿ®ŸàŸáŸäÿØÿ±ÿßÿ™",
                fat: "ÿßŸÑÿØŸáŸàŸÜ",
                backToHome: "ÿßŸÑÿπŸàÿØÿ© ÿ•ŸÑŸâ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©",
                historyTitle: "ÿ≥ÿ¨ŸÑ ÿßŸÑÿÆÿ∑ÿ∑",
                newPlan: "ÿÆÿ∑ÿ© ÿ¨ÿØŸäÿØÿ©",
                history: "ÿßŸÑÿ≥ÿ¨ŸÑ",
                welcome: "ŸÖÿ±ÿ≠ÿ®Ÿãÿß ÿ®ŸÉ ŸÅŸä MarrakFit",
                chooseOption: "ÿßÿÆÿ™ÿ± ÿÆŸäÿßÿ±Ÿãÿß ŸÑŸÑÿ®ÿØÿ°:",
                createNewPlan: "ÿ•ŸÜÿ¥ÿßÿ° ÿÆÿ∑ÿ© ÿ™ÿ∫ÿ∞Ÿäÿ© ÿ¥ÿÆÿµŸäÿ© ÿ¨ÿØŸäÿØÿ© ŸàŸÅŸÇŸãÿß ŸÑÿ£ŸáÿØÿßŸÅŸÉ",
                viewHistory: "ÿπÿ±ÿ∂ ÿßŸÑÿÆÿ∑ÿ∑ ÿßŸÑÿ™Ÿä ÿ£ŸÜÿ¥ÿ£ÿ™Ÿáÿß ÿ≥ÿßÿ®ŸÇŸãÿß",
                noPlans: "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿÆÿ∑ÿ∑ ŸÖÿ≠ŸÅŸàÿ∏ÿ© ÿ®ÿπÿØ",
                createFirstPlan: "ÿ£ŸÜÿ¥ÿ¶ ÿÆÿ∑ÿ™ŸÉ ÿßŸÑÿ£ŸàŸÑŸâ ŸÑÿ™ÿ∏Ÿáÿ± ŸáŸÜÿß",
                planSaved: "ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿÆÿ∑ÿ© ÿ®ŸÜÿ¨ÿßÿ≠!",
                viewPlans: "ÿπÿ±ÿ∂ ÿßŸÑÿ≥ÿ¨ŸÑ"
            }
        };

        // √âtat de l'application
        let currentLanguage = 'fr';
        let currentStep = 1;
        let userData = {};
        let nutritionPlan = {};

        // √âl√©ments DOM
        const homeSection = document.getElementById('homeSection');
        const historySection = document.getElementById('historySection');
        const personalInfoSection = document.getElementById('personalInfoSection');
        const goalSection = document.getElementById('goalSection');
        const resultsSection = document.getElementById('resultsSection');
        const planSection = document.getElementById('planSection');
        const stepIndicator = document.getElementById('stepIndicator');
        const historyList = document.getElementById('historyList');

        // Boutons de navigation
        document.getElementById('newPlanBtn').addEventListener('click', showPersonalInfo);
        document.getElementById('historyBtn').addEventListener('click', showHistory);
        document.getElementById('backToHomeFromHistoryBtn').addEventListener('click', showHome);
        document.getElementById('backToHomeFromFormBtn').addEventListener('click', showHome);
        document.getElementById('nextToGoalBtn').addEventListener('click', showGoal);
        document.getElementById('backToPersonalBtn').addEventListener('click', showPersonalInfo);
        document.getElementById('nextToResultsBtn').addEventListener('click', calculateResults);
        document.getElementById('backToGoalBtn').addEventListener('click', showGoal);
        document.getElementById('nextToPlanBtn').addEventListener('click', showPlan);
        document.getElementById('backToResultsBtn').addEventListener('click', showResults);
        document.getElementById('savePlanBtn').addEventListener('click', savePlan);
        document.getElementById('restartBtn').addEventListener('click', restartApp);

        // Gestionnaire de langue
        document.getElementById('languageBtn').addEventListener('click', function() {
            document.getElementById('languageOptions').classList.toggle('show');
        });

        document.querySelectorAll('.language-option').forEach(option => {
            option.addEventListener('click', function() {
                currentLanguage = this.getAttribute('data-lang');
                updateLanguage();
                document.getElementById('languageOptions').classList.remove('show');
            });
        });

        // Fonctions de navigation
        function showHome() {
            hideAllSections();
            homeSection.classList.remove('hidden');
            stepIndicator.classList.add('hidden');
            loadHistory();
        }

        function showHistory() {
            hideAllSections();
            historySection.classList.remove('hidden');
            stepIndicator.classList.add('hidden');
            loadHistory();
        }

        function showPersonalInfo() {
            hideAllSections();
            personalInfoSection.classList.remove('hidden');
            stepIndicator.classList.remove('hidden');
            updateStepIndicator(1);
        }

        function showGoal() {
            hideAllSections();
            goalSection.classList.remove('hidden');
            stepIndicator.classList.remove('hidden');
            updateStepIndicator(2);
        }

        function showResults() {
            hideAllSections();
            resultsSection.classList.remove('hidden');
            stepIndicator.classList.remove('hidden');
            updateStepIndicator(3);
        }

        function showPlan() {
            hideAllSections();
            planSection.classList.remove('hidden');
            stepIndicator.classList.remove('hidden');
            updateStepIndicator(4);
            generateNutritionPlan();
        }

        function hideAllSections() {
            homeSection.classList.add('hidden');
            historySection.classList.add('hidden');
            personalInfoSection.classList.add('hidden');
            goalSection.classList.add('hidden');
            resultsSection.classList.add('hidden');
            planSection.classList.add('hidden');
        }

        function updateStepIndicator(step) {
            document.querySelectorAll('.step').forEach((s, index) => {
                if (index + 1 < step) {
                    s.classList.remove('active');
                    s.classList.add('completed');
                } else if (index + 1 === step) {
                    s.classList.add('active');
                    s.classList.remove('completed');
                } else {
                    s.classList.remove('active', 'completed');
                }
            });
        }

        // Calculs nutritionnels
        function calculateResults() {
            // R√©cup√©rer les donn√©es du formulaire
            userData = {
                age: parseInt(document.getElementById('age').value),
                gender: document.getElementById('gender').value,
                weight: parseFloat(document.getElementById('weight').value),
                height: parseInt(document.getElementById('height').value),
                activityLevel: parseFloat(document.getElementById('activityLevel').value),
                goal: document.querySelector('input[name="goal"]:checked').value,
                intensity: parseInt(document.getElementById('intensity').value)
            };

            // Calcul du BMR (M√©tabolisme de base)
            let bmr;
            if (userData.gender === 'male') {
                bmr = 10 * userData.weight + 6.25 * userData.height - 5 * userData.age + 5;
            } else {
                bmr = 10 * userData.weight + 6.25 * userData.height - 5 * userData.age - 161;
            }

            // Calcul du TDEE (D√©pense √©nerg√©tique totale)
            const tdee = bmr * userData.activityLevel;

            // Calcul des calories selon l'objectif
            let goalCalories;
            if (userData.goal === 'muscle') {
                goalCalories = tdee + userData.intensity;
            } else if (userData.goal === 'weightLoss') {
                goalCalories = tdee - userData.intensity;
            } else {
                goalCalories = tdee;
            }

            // Calcul des macronutriments
            const proteinGrams = userData.weight * 2; // 2g/kg de poids corporel
            const proteinCalories = proteinGrams * 4;
            
            const fatCalories = goalCalories * 0.25; // 25% des calories
            const fatGrams = fatCalories / 9;
            
            const carbsCalories = goalCalories - proteinCalories - fatCalories;
            const carbsGrams = carbsCalories / 4;

            // Mettre √† jour l'interface avec les r√©sultats
            document.getElementById('bmrResult').textContent = Math.round(bmr) + ' calories';
            document.getElementById('tdeeResult').textContent = Math.round(tdee) + ' calories';
            document.getElementById('goalCaloriesResult').textContent = Math.round(goalCalories) + ' calories';
            
            // Mettre √† jour la description selon l'objectif
            let goalDescription = '';
            if (userData.goal === 'muscle') {
                goalDescription = 'Surplus calorique pour la prise de muscle';
            } else if (userData.goal === 'weightLoss') {
                goalDescription = 'D√©ficit calorique pour la perte de poids';
            } else {
                goalDescription = 'Maintien calorique pour stabiliser votre poids';
            }
            document.getElementById('goalDescription').textContent = goalDescription;

            // Mettre √† jour les macronutriments
            document.getElementById('proteinResult').textContent = Math.round(proteinGrams) + 'g';
            document.getElementById('proteinInfo').textContent = `(${Math.round(proteinCalories)} calories)`;
            
            document.getElementById('fatResult').textContent = Math.round(fatGrams) + 'g';
            document.getElementById('fatInfo').textContent = `(${Math.round(fatCalories)} calories)`;
            
            document.getElementById('carbsResult').textContent = Math.round(carbsGrams) + 'g';
            document.getElementById('carbsInfo').textContent = `(${Math.round(carbsCalories)} calories)`;

            // Stocker les r√©sultats pour le plan nutritionnel
            nutritionPlan = {
                goalCalories: Math.round(goalCalories),
                protein: Math.round(proteinGrams),
                carbs: Math.round(carbsGrams),
                fat: Math.round(fatGrams)
            };

            showResults();
        }

        // Structure fixe du plan nutritionnel (identique √† votre code original)
        const mealStructure = [
            // Petit-d√©jeuner
            { meal: "breakfast", food: "≈íufs", baseWeight: 150, calories: 210, protein: 18, carbs: 0, fat: 15 },
            { meal: "breakfast", food: "Pain complet", baseWeight: 50, calories: 130, protein: 5, carbs: 25, fat: 2 },
            { meal: "breakfast", food: "Avocat", baseWeight: 50, calories: 80, protein: 0, carbs: 4, fat: 7 },
            { meal: "breakfast", food: "Fruit", baseWeight: 100, calories: 80, protein: 0, carbs: 20, fat: 0 },
            { meal: "breakfast", food: "Huile d'olive", baseWeight: 5, calories: 40, protein: 0, carbs: 0, fat: 5 },
            
            // D√©jeuner
            { meal: "lunch", food: "Poulet grill√©", baseWeight: 180, calories: 330, protein: 40, carbs: 0, fat: 15 },
            { meal: "lunch", food: "Riz complet cuit", baseWeight: 120, calories: 150, protein: 3, carbs: 35, fat: 0 },
            { meal: "lunch", food: "L√©gumes vapeur", baseWeight: 200, calories: 70, protein: 0, carbs: 15, fat: 0 },
            { meal: "lunch", food: "Huile d'olive", baseWeight: 15, calories: 120, protein: 0, carbs: 0, fat: 14 },
            
            // Collation apr√®s-midi
            { meal: "snack", food: "Fruit", baseWeight: 100, calories: 80, protein: 0, carbs: 20, fat: 0 },
            { meal: "snack", food: "Noix", baseWeight: 20, calories: 120, protein: 5, carbs: 0, fat: 12 },
            
            // D√Æner
            { meal: "dinner", food: "Poulet grill√©", baseWeight: 150, calories: 275, protein: 35, carbs: 0, fat: 12 },
            { meal: "dinner", food: "Riz complet cuit", baseWeight: 100, calories: 130, protein: 2, carbs: 28, fat: 0 },
            { meal: "dinner", food: "Salade verte", baseWeight: 150, calories: 40, protein: 0, carbs: 8, fat: 0 },
            { meal: "dinner", food: "Huile d'olive", baseWeight: 15, calories: 120, protein: 0, carbs: 0, fat: 14 }
        ];

        // G√©n√©ration du plan nutritionnel (version restaur√©e)
        function generateNutritionPlan() {
            const planTableContainer = document.getElementById('planTableContainer');
            const dailyCaloriesPlan = document.getElementById('dailyCaloriesPlan');
            
            dailyCaloriesPlan.textContent = nutritionPlan.goalCalories;
            
            // Facteur d'ajustement selon les calories totales
            const baseCalories = 2000; // Calories de r√©f√©rence du plan de base
            const adjustmentFactor = nutritionPlan.goalCalories / baseCalories;
            
            // Cr√©er le tableau
            const table = document.createElement('table');
            table.className = 'plan-table';
            
            // En-t√™te du tableau
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            
            const headers = [
                translations[currentLanguage].food,
                translations[currentLanguage].weight,
                translations[currentLanguage].calories,
                translations[currentLanguage].nutrition
            ];
            
            headers.forEach(headerText => {
                const th = document.createElement('th');
                th.textContent = headerText;
                headerRow.appendChild(th);
            });
            
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // Corps du tableau
            const tbody = document.createElement('tbody');
            
            // Variables pour les totaux
            let currentMeal = '';
            let mealCalories = 0;
            let mealProtein = 0;
            let mealCarbs = 0;
            let mealFat = 0;
            
            let dailyCalories = 0;
            let dailyProtein = 0;
            let dailyCarbs = 0;
            let dailyFat = 0;
            
            mealStructure.forEach((item, index) => {
                // Si on change de repas, ajouter la ligne de total du repas pr√©c√©dent
                if (currentMeal !== '' && currentMeal !== item.meal) {
                    addMealTotalRow(currentMeal, mealCalories, mealProtein, mealCarbs, mealFat);
                    
                    // R√©initialiser les totaux du repas
                    mealCalories = 0;
                    mealProtein = 0;
                    mealCarbs = 0;
                    mealFat = 0;
                }
                
                // Si c'est le d√©but d'un nouveau repas, ajouter l'en-t√™te du repas
                if (currentMeal !== item.meal) {
                    currentMeal = item.meal;
                    
                    const mealHeaderRow = document.createElement('tr');
                    mealHeaderRow.className = 'meal-header';
                    
                    const mealHeaderCell = document.createElement('td');
                    mealHeaderCell.colSpan = 4;
                    mealHeaderCell.textContent = translations[currentLanguage][item.meal];
                    mealHeaderRow.appendChild(mealHeaderCell);
                    
                    tbody.appendChild(mealHeaderRow);
                }
                
                // Ajuster la quantit√© selon les calories n√©cessaires
                const adjustedWeight = Math.round(item.baseWeight * adjustmentFactor);
                const adjustedCalories = Math.round(item.calories * adjustmentFactor);
                const adjustedProtein = Math.round(item.protein * adjustmentFactor);
                const adjustedCarbs = Math.round(item.carbs * adjustmentFactor);
                const adjustedFat = Math.round(item.fat * adjustmentFactor);
                
                // Ajouter les valeurs aux totaux
                mealCalories += adjustedCalories;
                mealProtein += adjustedProtein;
                mealCarbs += adjustedCarbs;
                mealFat += adjustedFat;
                
                dailyCalories += adjustedCalories;
                dailyProtein += adjustedProtein;
                dailyCarbs += adjustedCarbs;
                dailyFat += adjustedFat;
                
                // Ligne de l'aliment
                const row = document.createElement('tr');
                
                // Colonne Aliment
                const foodCell = document.createElement('td');
                foodCell.textContent = item.food;
                row.appendChild(foodCell);
                
                // Colonne Poids
                const weightCell = document.createElement('td');
                weightCell.textContent = `${adjustedWeight}g`;
                row.appendChild(weightCell);
                
                // Colonne Calories
                const caloriesCell = document.createElement('td');
                caloriesCell.textContent = `${adjustedCalories} kcal`;
                row.appendChild(caloriesCell);
                
                // Colonne Apports nutritionnels
                const nutritionCell = document.createElement('td');
                let nutritionText = '';
                
                if (adjustedProtein > 0) {
                    nutritionText += `${translations[currentLanguage].protein} ${adjustedProtein}g`;
                }
                if (adjustedCarbs > 0) {
                    if (nutritionText) nutritionText += ', ';
                    nutritionText += `${translations[currentLanguage].carbs} ${adjustedCarbs}g`;
                }
                if (adjustedFat > 0) {
                    if (nutritionText) nutritionText += ', ';
                    nutritionText += `${translations[currentLanguage].fat} ${adjustedFat}g`;
                }
                
                nutritionCell.textContent = nutritionText;
                row.appendChild(nutritionCell);
                
                tbody.appendChild(row);
                
                // Si c'est le dernier aliment, ajouter le total du repas
                if (index === mealStructure.length - 1) {
                    addMealTotalRow(currentMeal, mealCalories, mealProtein, mealCarbs, mealFat);
                }
            });
            
            // Fonction pour ajouter une ligne de total de repas
            function addMealTotalRow(meal, calories, protein, carbs, fat) {
                const totalRow = document.createElement('tr');
                totalRow.className = 'meal-total-row';
                
                const totalCell = document.createElement('td');
                totalCell.colSpan = 2;
                totalCell.textContent = `${translations[currentLanguage][meal]} - ${translations[currentLanguage].total}`;
                totalRow.appendChild(totalCell);
                
                const caloriesCell = document.createElement('td');
                caloriesCell.textContent = `${calories} kcal`;
                totalRow.appendChild(caloriesCell);
                
                const nutritionCell = document.createElement('td');
                let nutritionText = '';
                
                if (protein > 0) nutritionText += `${translations[currentLanguage].protein} ${protein}g`;
                if (carbs > 0) nutritionText += (nutritionText ? ', ' : '') + `${translations[currentLanguage].carbs} ${carbs}g`;
                if (fat > 0) nutritionText += (nutritionText ? ', ' : '') + `${translations[currentLanguage].fat} ${fat}g`;
                
                nutritionCell.textContent = nutritionText;
                totalRow.appendChild(nutritionCell);
                
                tbody.appendChild(totalRow);
            }
            
            // Ajouter la ligne de total quotidien
            const dailyTotalRow = document.createElement('tr');
            dailyTotalRow.className = 'daily-total-row';
            
            const dailyTotalCell = document.createElement('td');
            dailyTotalCell.colSpan = 2;
            dailyTotalCell.textContent = translations[currentLanguage].dailyTotal;
            dailyTotalRow.appendChild(dailyTotalCell);
            
            const dailyCaloriesCell = document.createElement('td');
            dailyCaloriesCell.textContent = `${dailyCalories} kcal`;
            dailyTotalRow.appendChild(dailyCaloriesCell);
            
            const dailyNutritionCell = document.createElement('td');
            let dailyNutritionText = '';
            
            if (dailyProtein > 0) dailyNutritionText += `${translations[currentLanguage].protein} ${dailyProtein}g`;
            if (dailyCarbs > 0) dailyNutritionText += (dailyNutritionText ? ', ' : '') + `${translations[currentLanguage].carbs} ${dailyCarbs}g`;
            if (dailyFat > 0) dailyNutritionText += (dailyNutritionText ? ', ' : '') + `${translations[currentLanguage].fat} ${dailyFat}g`;
            
            dailyNutritionCell.textContent = dailyNutritionText;
            dailyTotalRow.appendChild(dailyNutritionCell);
            
            tbody.appendChild(dailyTotalRow);
            
            table.appendChild(tbody);
            planTableContainer.innerHTML = '';
            planTableContainer.appendChild(table);
        }

        // Sauvegarde du plan
        function savePlan() {
            const planData = {
                id: Date.now(),
                title: `Plan du ${new Date().toLocaleDateString()} √† ${new Date().toLocaleTimeString()}`,
                date: new Date().toISOString(),
                userData: userData,
                nutritionPlan: nutritionPlan
            };

            // R√©cup√©rer les plans existants
            const savedPlans = JSON.parse(localStorage.getItem('marrakfit_plans') || '[]');
            
            // Ajouter le nouveau plan
            savedPlans.unshift(planData);
            
            // Sauvegarder dans le localStorage
            localStorage.setItem('marrakfit_plans', JSON.stringify(savedPlans));
            
            alert(translations[currentLanguage].planSaved);
            showHome();
        }

        // Chargement de l'historique
        function loadHistory() {
            const savedPlans = JSON.parse(localStorage.getItem('marrakfit_plans') || '[]');
            const historyList = document.getElementById('historyList');
            
            if (savedPlans.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-history">
                        <p>${translations[currentLanguage].noPlans}</p>
                        <p>${translations[currentLanguage].createFirstPlan}</p>
                        <button id="createFirstPlanBtn" class="btn-primary">${translations[currentLanguage].newPlan}</button>
                    </div>
                `;
                
                document.getElementById('createFirstPlanBtn').addEventListener('click', showPersonalInfo);
            } else {
                historyList.innerHTML = savedPlans.map(plan => `
                    <div class="history-item" data-plan-id="${plan.id}">
                        <h4>${plan.title}</h4>
                        <p>${new Date(plan.date).toLocaleString()}</p>
                        <p>Objectif: ${plan.userData.goal === 'muscle' ? 'Prise de muscle' : 
                                      plan.userData.goal === 'weightLoss' ? 'Perte de poids' : 'Maintien'}</p>
                        <p>Calories: ${plan.nutritionPlan.goalCalories} kcal/jour</p>
                    </div>
                `).join('');
                
                // Ajouter les √©v√©nements de clic pour charger les plans
                document.querySelectorAll('.history-item').forEach(item => {
                    item.addEventListener('click', function() {
                        const planId = this.getAttribute('data-plan-id');
                        loadPlan(planId);
                    });
                });
            }
        }

        function loadPlan(planId) {
            const savedPlans = JSON.parse(localStorage.getItem('marrakfit_plans') || '[]');
            const plan = savedPlans.find(p => p.id == planId);
            
            if (plan) {
                userData = plan.userData;
                nutritionPlan = plan.nutritionPlan;
                
                // Remplir le formulaire avec les donn√©es sauvegard√©es
                document.getElementById('age').value = userData.age;
                document.getElementById('gender').value = userData.gender;
                document.getElementById('weight').value = userData.weight;
                document.getElementById('height').value = userData.height;
                document.getElementById('activityLevel').value = userData.activityLevel;
                
                // S√©lectionner le bon objectif
                document.querySelectorAll('input[name="goal"]').forEach(radio => {
                    if (radio.value === userData.goal) {
                        radio.checked = true;
                    }
                });
                
                document.getElementById('intensity').value = userData.intensity;
                
                // Afficher les r√©sultats
                calculateResults();
                showPlan();
            }
        }

        function restartApp() {
            // R√©initialiser le formulaire
            document.getElementById('personalInfoForm').reset();
            document.getElementById('goalForm').reset();
            
            // R√©initialiser les donn√©es
            userData = {};
            nutritionPlan = {};
            
            // Retourner √† l'accueil
            showHome();
        }

        // Mise √† jour de la langue
        function updateLanguage() {
            const elements = document.querySelectorAll('[id]');
            elements.forEach(element => {
                const id = element.id;
                if (translations[currentLanguage][id]) {
                    if (element.tagName === 'INPUT' || element.tagName === 'SELECT') {
                        if (element.placeholder !== undefined) {
                            element.placeholder = translations[currentLanguage][id];
                        } else if (element.options && element.options.length > 0) {
                            // Pour les selects, on met √† jour les options
                            if (id === 'gender' || id === 'activityLevel' || id === 'intensity') {
                                // Les options sont mises √† jour via leurs propres IDs
                            }
                        }
                    } else {
                        element.textContent = translations[currentLanguage][id];
                    }
                }
            });
            
            // Mettre √† jour le texte du bouton de langue
            document.getElementById('currentLanguage').textContent = translations[currentLanguage].currentLanguage;
            
            // Reg√©n√©rer le plan nutritionnel si on est sur cette page
            if (!planSection.classList.contains('hidden')) {
                generateNutritionPlan();
            }
            
            // Recharger l'historique si on est sur cette page
            if (!historySection.classList.contains('hidden')) {
                loadHistory();
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            updateLanguage();
            showHome();
        });
    </script>
</body>
</html>
