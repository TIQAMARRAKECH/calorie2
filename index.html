<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarrakFit â€“ Votre coach calories & macros made in Morocco</title>
    <style>
        :root {
            --primary-color: #C1272D; /* Rouge Marrakech */
            --primary-dark: #A02025;
            --primary-light: #E8B4B6;
            --secondary-color: #D4AF37; /* Or marocain */
            --secondary-dark: #B8941F;
            --secondary-light: #F4E4A9;
            --accent-color: #228B22; /* Vert palmier */
            --text-color: #2F2F2F;
            --text-light: #666;
            --background-color: #FDF6E3; /* Beige sable */
            --card-background: #FFFFFF;
            --border-color: #E0D6C3;
            --error-color: #C1272D;
            --success-color: #228B22;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
            min-height: 100vh;
            position: relative;
            transition: all 0.3s ease;
        }

        /* ArriÃ¨re-plan avec palmiers */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path d="M50,10 C60,20 65,30 60,40 C55,50 45,55 50,65 C55,75 60,80 50,90 C40,80 45,75 50,65 C55,55 45,50 40,40 C35,30 40,20 50,10 Z" fill="%23228B22" opacity="0.1"/></svg>');
            background-size: 200px;
            opacity: 0.3;
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }

        .language-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .language-btn:hover {
            background: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .language-options {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            padding: 10px 0;
            margin-top: 5px;
            display: none;
            min-width: 150px;
        }

        .language-options.show {
            display: block;
        }

        .language-option {
            padding: 8px 15px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .language-option:hover {
            background: var(--primary-light);
        }

        header {
            text-align: center;
            padding: 30px 0;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        /* Motif marocain dÃ©coratif */
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path d="M50,10 C60,20 65,30 60,40 C55,50 45,55 50,65 C55,75 60,80 50,90 C40,80 45,75 50,65 C55,55 45,50 40,40 C35,30 40,20 50,10 Z" fill="white" opacity="0.1"/></svg>');
            background-size: 150px;
            opacity: 0.2;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .section {
            background-color: var(--card-background);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
            border: 1px solid var(--border-color);
            position: relative;
        }

        .section:hover {
            transform: translateY(-5px);
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--primary-dark);
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: "âœ¦";
            color: var(--secondary-color);
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
            transition: border 0.3s;
            background-color: #FFF;
        }

        input:focus, select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(193, 39, 45, 0.2);
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .radio-option input {
            width: auto;
        }

        button {
            cursor: pointer;
            border: none;
            border-radius: 5px;
            padding: 12px 20px;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(193, 39, 45, 0.3);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: var(--secondary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(212, 175, 55, 0.3);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #1e7b1e;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(34, 139, 34, 0.3);
        }

        .result-card {
            background: linear-gradient(135deg, #FDF6E3, #F4E4A9);
            border-left: 5px solid var(--primary-color);
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .result-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--primary-dark);
        }

        .result-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .result-value span:last-child {
            font-size: 1.5rem;
        }

        .hidden {
            display: none;
        }

        .progress-bar {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }

        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            z-index: 2;
            transition: all 0.3s ease;
        }

        .step.active {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 2px 5px rgba(193, 39, 45, 0.3);
        }

        .step.completed {
            background-color: var(--success-color);
            color: white;
        }

        .step-indicator::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            height: 2px;
            background-color: #e0e0e0;
            z-index: 1;
        }

        .plan-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .plan-table th, .plan-table td {
            border: 1px solid var(--border-color);
            padding: 10px;
            text-align: left;
        }

        .plan-table th {
            background-color: var(--primary-light);
            font-weight: bold;
        }

        .plan-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .plan-table .meal-header {
            background-color: var(--secondary-light);
            font-weight: bold;
        }

        .plan-table .meal-total-row {
            background-color: #e8f5e9;
            font-weight: bold;
        }

        .plan-table .daily-total-row {
            background-color: var(--primary-light);
            font-weight: bold;
            font-size: 1.1em;
        }

        /* Styles pour la page d'accueil */
        .home-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .home-option {
            background: white;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            border: 2px solid transparent;
            cursor: pointer;
        }

        .home-option:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
        }

        .home-option-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .home-option-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--primary-dark);
        }

        .home-option-description {
            color: var(--text-light);
            margin-bottom: 20px;
        }

        /* Styles pour l'historique */
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .history-item {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .history-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .history-item-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-dark);
        }

        .history-item-date {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .history-item-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            font-size: 0.9rem;
        }

        .history-detail {
            display: flex;
            flex-direction: column;
        }

        .history-detail-label {
            font-weight: 600;
            color: var(--text-light);
        }

        .history-detail-value {
            color: var(--primary-color);
            font-weight: bold;
        }

        .empty-history {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
        }

        .empty-history-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .back-button {
            margin-bottom: 20px;
        }

        /* Styles pour la modale de don */
        .donation-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .donation-modal-content {
            background: var(--card-background);
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 90%;
            text-align: center;
            position: relative;
        }

        .donation-modal-content h3 {
            color: var(--primary-dark);
            margin-bottom: 15px;
        }

        .donation-modal-content p {
            margin-bottom: 25px;
            color: var(--text-color);
        }

        .donation-buttons {
            display: flex;
            justify-content: space-around;
            gap: 15px;
        }
        
        .donation-paypal {
            margin-top: 20px;
            padding: 15px;
            border: 1px dashed var(--secondary-color);
            border-radius: 5px;
            background-color: var(--secondary-light);
        }

        .donation-paypal-email {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary-dark);
            margin-bottom: 10px;
            word-break: break-all;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .radio-group {
                flex-direction: column;
                gap: 10px;
            }
            
            header h1 {
                font-size: 2rem;
            }
            
            .language-selector {
                position: relative;
                top: 0;
                right: 0;
                margin-bottom: 20px;
                display: flex;
                justify-content: center;
            }
            
            .plan-table {
                font-size: 0.8rem;
            }
            
            .plan-table th, .plan-table td {
                padding: 5px;
            }
            
            .home-options {
                grid-template-columns: 1fr;
            }
            
            .history-item-details {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .plan-table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="language-selector">
            <div class="language-btn" id="languageBtn">
                <span>ğŸŒ</span>
                <span id="currentLanguage">FranÃ§ais</span>
                <span>â–¼</span>
            </div>
            <div class="language-options" id="languageOptions">
                <div class="language-option" data-lang="fr">FranÃ§ais</div>
                <div class="language-option" data-lang="en">English</div>
                <div class="language-option" data-lang="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
            </div>
        </div>

        <header>
            <h1 id="appTitle">MarrakFit â€“ Votre coach calories & macros made in Morocco</h1>
            <p id="appSubtitle">Obtenez votre plan alimentaire personnalisÃ© selon vos objectifs</p>
        </header>

        <div class="app-container">
            <section id="homeSection" class="section">
                <h2 class="section-title" id="homeTitle">Accueil</h2>
                
                <div class="home-options">
                    <div class="home-option" id="newPlanOption">
                        <div class="home-option-icon">ğŸ“Š</div>
                        <h3 class="home-option-title" id="newPlanTitle">Nouveau plan</h3>
                        <p class="home-option-description" id="newPlanDescription">CrÃ©ez un nouveau plan nutritionnel personnalisÃ© selon vos objectifs</p>
                        <button class="btn-primary" id="startNewPlanBtn">Commencer</button>
                    </div>
                    
                    <div class="home-option" id="historyOption">
                        <div class="home-option-icon">ğŸ“‹</div>
                        <h3 class="home-option-title" id="historyTitle">Historique</h3>
                        <p class="home-option-description" id="historyDescription">Consultez vos plans nutritionnels prÃ©cÃ©demment crÃ©Ã©s</p>
                        <button class="btn-secondary" id="viewHistoryBtn">Voir l'historique</button>
                    </div>
                </div>
            </section>

            <section id="historySection" class="section hidden">
                <div class="back-button">
                    <button class="btn-secondary" id="backFromHistoryBtn">â† Retour Ã  l'accueil</button>
                </div>
                
                <h2 class="section-title" id="historyPageTitle">Historique des plans</h2>
                
                <div id="historyList" class="history-list">
                    </div>
                
                <div id="emptyHistory" class="empty-history hidden">
                    <div class="empty-history-icon">ğŸ“‹</div>
                    <h3 id="emptyHistoryTitle">Aucun plan sauvegardÃ©</h3>
                    <p id="emptyHistoryDescription">Commencez par crÃ©er votre premier plan nutritionnel</p>
                    <button class="btn-primary" id="createFirstPlanBtn">CrÃ©er un nouveau plan</button>
                </div>
            </section>

            <div class="step-indicator hidden" id="stepIndicator">
                <div class="step active" id="step1">1</div>
                <div class="step" id="step2">2</div>
                <div class="step" id="step3">3</div>
                <div class="step" id="step4">4</div>
            </div>

            <section id="personalInfoSection" class="section hidden">
                <h2 class="section-title" id="personalInfoTitle">Informations Personnelles</h2>
                <form id="personalInfoForm">
                    <div class="form-group">
                        <label for="age" id="ageLabel">Ã‚ge</label>
                        <input type="number" id="age" min="15" max="100" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="gender" id="genderLabel">Genre</label>
                        <select id="gender" required>
                            <option value="" id="genderDefault">SÃ©lectionnez votre genre</option>
                            <option value="male" id="genderMale">Homme</option>
                            <option value="female" id="genderFemale">Femme</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="weight" id="weightLabel">Poids (kg)</label>
                        <input type="number" id="weight" min="30" max="200" step="0.1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="height" id="heightLabel">Taille (cm)</label>
                        <input type="number" id="height" min="100" max="250" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="activityLevel" id="activityLabel">Niveau d'activitÃ©</label>
                        <select id="activityLevel" required>
                            <option value="" id="activityDefault">SÃ©lectionnez votre niveau d'activitÃ©</option>
                            <option value="1.2" id="activitySedentary">SÃ©dentaire (peu ou pas d'exercice)</option>
                            <option value="1.375" id="activityLight">LÃ©gÃ¨rement actif (1-3 jours/semaine)</option>
                            <option value="1.55" id="activityModerate">ModÃ©rÃ©ment actif (3-5 jours/semaine)</option>
                            <option value="1.725" id="activityActive">TrÃ¨s actif (6-7 jours/semaine)</option>
                            <option value="1.9" id="activityExtreme">ExtrÃªmement actif (entraÃ®nement intense quotidien)</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" id="backToHomeFromPersonalBtn" class="btn-secondary">Retour Ã  l'accueil</button>
                        <button type="button" id="nextToGoalBtn" class="btn-primary">Suivant</button>
                    </div>
                </form>
            </section>

            <section id="goalSection" class="section hidden">
                <h2 class="section-title" id="goalTitle">Votre Objectif</h2>
                <form id="goalForm">
                    <div class="form-group">
                        <label id="goalQuestion">Que souhaitez-vous atteindre ?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="goalMuscle" name="goal" value="muscle" required>
                                <label for="goalMuscle" id="goalMuscleLabel">Prendre du muscle</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="goalWeightLoss" name="goal" value="weightLoss">
                                <label for="goalWeightLoss" id="goalWeightLossLabel">Perdre du poids</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="goalMaintain" name="goal" value="maintain">
                                <label for="goalMaintain" id="goalMaintainLabel">Maintenir mon poids</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="intensity" id="intensityLabel">IntensitÃ© de l'objectif</label>
                        <select id="intensity" required>
                            <option value="" id="intensityDefault">SÃ©lectionnez l'intensitÃ©</option>
                            <option value="250" id="intensityLight">LÃ©ger (+/- 250 kcal)</option>
                            <option value="500" selected id="intensityModerate">ModÃ©rÃ© (+/- 500 kcal)</option>
                            <option value="750" id="intensityIntense">Intense (+/- 750 kcal)</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" id="backToPersonalBtn" class="btn-secondary">PrÃ©cÃ©dent</button>
                        <button type="button" id="nextToResultsBtn" class="btn-primary">Calculer mes besoins</button>
                    </div>
                </form>
            </section>

            <section id="resultsSection" class="section hidden">
                <h2 class="section-title" id="resultsTitle">Vos Besoins Nutritionnels</h2>
                
                <div class="result-card">
                    <h3 class="result-title" id="imcTitle">Votre Indice de Masse Corporelle (IMC)</h3>
                    <div class="result-value" id="imcResult">0.0 <span></span></div>
                    <p id="imcDescription">L'IMC est une indication de votre corpulence</p>
                </div>

                <div class="result-card">
                    <h3 class="result-title" id="tdeeTitle">Votre dÃ©pense Ã©nergÃ©tique totale (TDEE)</h3>
                    <div class="result-value" id="tdeeResult">0 calories</div>
                    <p id="tdeeDescription">Calories nÃ©cessaires en fonction de votre niveau d'activitÃ©</p>
                </div>
                
                <div class="result-card">
                    <h3 class="result-title" id="goalCaloriesTitle">Calories recommandÃ©es pour votre objectif</h3>
                    <div class="result-value" id="goalCaloriesResult">0 calories</div>
                    <p id="goalDescription"></p>
                </div>
                
                <div class="result-card">
                    <h3 class="result-title" id="macrosTitle">RÃ©partition des macronutriments</h3>
                    <div class="macronutrients">
                        <p><strong id="proteinLabel">ProtÃ©ines:</strong> <span id="proteinResult">0g</span> <span id="proteinInfo"></span></p>
                        <p><strong id="fatLabel">Lipides:</strong> <span id="fatResult">0g</span> <span id="fatInfo"></span></p>
                        <p><strong id="carbsLabel">Glucides:</strong> <span id="carbsResult">0g</span> <span id="carbsInfo">(reste des calories)</span></p>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" id="backToGoalBtn" class="btn-secondary">PrÃ©cÃ©dent</button>
                    <button type="button" id="nextToPlanBtn" class="btn-primary">Voir mon plan nutritionnel</button>
                </div>
            </section>

            <section id="planSection" class="section hidden">
                <h2 class="section-title" id="planTitle">Votre Plan Nutritionnel Quotidien</h2>
                <p id="planDescription">BasÃ© sur vos besoins de <span id="dailyCaloriesPlan">0</span> calories</p>
                
                <div id="planTableContainer">
                    </div>
                
                <div class="form-actions">
                    <button type="button" id="backToResultsBtn" class="btn-secondary">PrÃ©cÃ©dent</button>
                    <button type="button" id="savePlanBtn" class="btn-success">Sauvegarder ce plan</button>
                    <button type="button" id="restartBtn" class="btn-primary">CrÃ©er un nouveau plan</button>
                </div>
            </section>

            <section id="savedPlanSection" class="section hidden">
                <div class="back-button">
                    <button class="btn-secondary" id="backFromSavedPlanBtn">â† Retour Ã  l'historique</button>
                </div>
                
                <h2 class="section-title" id="savedPlanTitle">Plan nutritionnel</h2>
                <p id="savedPlanDate">Date de crÃ©ation: </p>
                
                <div class="result-card">
                    <h3 class="result-title">Informations personnelles</h3>
                    <div id="savedPersonalInfo">
                        </div>
                </div>
                
                <div class="result-card">
                    <h3 class="result-title">Besoins nutritionnels</h3>
                    <div id="savedNutritionalNeeds">
                        </div>
                </div>
                
                <div id="savedPlanTableContainer">
                    </div>
                
                <div class="form-actions">
                    <button type="button" id="backToHistoryFromSavedBtn" class="btn-secondary">Retour Ã  l'historique</button>
                    <button type="button" id="deleteSavedPlanBtn" class="btn-primary" style="background-color: var(--error-color);">Supprimer ce plan</button>
                </div>
            </section>
        </div>
    </div>
    
    <div class="donation-modal-overlay" id="donationModal">
        <div class="donation-modal-content">
            <h3 id="donationTitle">Soutenez MarrakFit !</h3>
            <p id="donationMessage">Si ce plan nutritionnel vous a Ã©tÃ© utile, pensez Ã  soutenir le dÃ©veloppeur par un petit don.</p>
            
            <div id="donationInitial">
                <div class="donation-buttons">
                    <button class="btn-primary" id="showPaypalBtn">Faire un don</button>
                    <button class="btn-secondary" id="closeModalBtn">Plus tard</button>
                </div>
            </div>

            <div id="donationPaypalInfo" class="hidden">
                <div class="donation-paypal">
                    <p id="paypalText">Adresse PayPal pour les dons :</p>
                    <div class="donation-paypal-email" id="paypalEmail">yassineabourayan@gmail.com</div>
                    <button class="btn-success" id="copyPaypalBtn">Copier</button>
                </div>
                <button class="btn-secondary" id="closePaypalInfoBtn" style="margin-top: 15px;">Fermer</button>
            </div>
        </div>
    </div>

    <script>
        // Textes multilingues
        const translations = {
            fr: {
                appTitle: "MarrakFit â€“ Votre coach calories & macros made in Morocco",
                appSubtitle: "Obtenez votre plan alimentaire personnalisÃ© selon vos objectifs",
                currentLanguage: "FranÃ§ais",
                homeTitle: "Accueil",
                newPlanTitle: "Nouveau plan",
                newPlanDescription: "CrÃ©ez un nouveau plan nutritionnel personnalisÃ© selon vos objectifs",
                historyTitle: "Historique",
                historyDescription: "Consultez vos plans nutritionnels prÃ©cÃ©demment crÃ©Ã©s",
                historyPageTitle: "Historique des plans",
                emptyHistoryTitle: "Aucun plan sauvegardÃ©",
                emptyHistoryDescription: "Commencez par crÃ©er votre premier plan nutritionnel",
                personalInfoTitle: "Informations Personnelles",
                ageLabel: "Ã‚ge",
                genderLabel: "Genre",
                genderDefault: "SÃ©lectionnez votre genre",
                genderMale: "Homme",
                genderFemale: "Femme",
                weightLabel: "Poids (kg)",
                heightLabel: "Taille (cm)",
                activityLabel: "Niveau d'activitÃ©",
                activityDefault: "SÃ©lectionnez votre niveau d'activitÃ©",
                activitySedentary: "SÃ©dentaire (peu ou pas d'exercice)",
                activityLight: "LÃ©gÃ¨rement actif (1-3 jours/semaine)",
                activityModerate: "ModÃ©rÃ©ment actif (3-5 jours/semaine)",
                activityActive: "TrÃ¨s actif (6-7 jours/semaine)",
                activityExtreme: "ExtrÃªmement actif (entraÃ®nement intense quotidien)",
                nextButton: "Suivant",
                goalTitle: "Votre Objectif",
                goalQuestion: "Que souhaitez-vous atteindre ?",
                goalMuscleLabel: "Prendre du muscle",
                goalWeightLossLabel: "Perdre du poids",
                goalMaintainLabel: "Maintenir mon poids",
                intensityLabel: "IntensitÃ© de l'objectif",
                intensityDefault: "SÃ©lectionnez l'intensitÃ©",
                intensityLight: "LÃ©ger (+/- 250 kcal)",
                intensityModerate: "ModÃ©rÃ© (+/- 500 kcal)",
                intensityIntense: "Intense (+/- 750 kcal)",
                previousButton: "PrÃ©cÃ©dent",
                calculateButton: "Calculer mes besoins",
                resultsTitle: "Vos Besoins Nutritionnels",
                // Suppression du BMR
                imcTitle: "Votre Indice de Masse Corporelle (IMC)",
                imcDescription: "L'IMC est une indication de votre corpulence",
                imcUnderweight: "Insuffisance pondÃ©rale",
                imcNormal: "Poids normal",
                imcOverweight: "Surpoids",
                imcObesity1: "ObÃ©sitÃ© classe I",
                imcObesity2: "ObÃ©sitÃ© classe II",
                imcObesity3: "ObÃ©sitÃ© classe III",
                tdeeTitle: "Votre dÃ©pense Ã©nergÃ©tique totale (TDEE)",
                tdeeDescription: "Calories nÃ©cessaires en fonction de votre niveau d'activitÃ©",
                goalCaloriesTitle: "Calories recommandÃ©es pour votre objectif",
                macrosTitle: "RÃ©partition des macronutriments",
                proteinLabel: "ProtÃ©ines:",
                fatLabel: "Lipides:",
                carbsLabel: "Glucides:",
                carbsInfo: "(reste des calories)",
                viewPlanButton: "Voir mon plan nutritionnel",
                planTitle: "Votre Plan Nutritionnel Quotidien",
                planDescription: "BasÃ© sur vos besoins de",
                restartButton: "CrÃ©er un nouveau plan",
                savePlanButton: "Sauvegarder ce plan",
                meal: "Repas",
                food: "Aliment",
                weight: "Poids",
                calories: "Calories",
                nutrition: "Apports approximatifs",
                breakfast: "Petit-dÃ©jeuner",
                lunch: "DÃ©jeuner",
                snack: "Collation",
                dinner: "DÃ®ner",
                total: "Total",
                dailyTotal: "Total quotidien",
                protein: "ProtÃ©ines",
                carbs: "Glucides",
                fat: "Lipides",
                backToHome: "Retour Ã  l'accueil",
                backToHistory: "Retour Ã  l'historique",
                viewHistory: "Voir l'historique",
                startNewPlan: "Commencer",
                createFirstPlan: "CrÃ©er un nouveau plan",
                planSaved: "Plan sauvegardÃ© avec succÃ¨s!",
                planDeleted: "Plan supprimÃ© avec succÃ¨s!",
                confirmDelete: "ÃŠtes-vous sÃ»r de vouloir supprimer ce plan ?",
                // Donation
                donationTitle: "Soutenez MarrakFit !",
                donationMessage: "Si ce plan nutritionnel vous a Ã©tÃ© utile, pensez Ã  soutenir le dÃ©veloppeur par un petit don. Cela nous aide Ã  maintenir et amÃ©liorer l'application.",
                showPaypalBtn: "Faire un don",
                closeModalBtn: "Plus tard",
                paypalText: "Adresse PayPal pour les dons :",
                copyButton: "Copier",
                paypalCopied: "E-mail PayPal copiÃ©!"
            },
            en: {
                appTitle: "MarrakFit â€“ Your calories & macros coach made in Morocco",
                appSubtitle: "Get your personalized meal plan according to your goals",
                currentLanguage: "English",
                homeTitle: "Home",
                newPlanTitle: "New plan",
                newPlanDescription: "Create a new personalized nutrition plan according to your goals",
                historyTitle: "History",
                historyDescription: "View your previously created nutrition plans",
                historyPageTitle: "Plan History",
                emptyHistoryTitle: "No saved plans",
                emptyHistoryDescription: "Start by creating your first nutrition plan",
                personalInfoTitle: "Personal Information",
                ageLabel: "Age",
                genderLabel: "Gender",
                genderDefault: "Select your gender",
                genderMale: "Male",
                genderFemale: "Female",
                weightLabel: "Weight (kg)",
                heightLabel: "Height (cm)",
                activityLabel: "Activity Level",
                activityDefault: "Select your activity level",
                activitySedentary: "Sedentary (little or no exercise)",
                activityLight: "Lightly active (1-3 days/week)",
                activityModerate: "Moderately active (3-5 days/week)",
                activityActive: "Very active (6-7 days/week)",
                activityExtreme: "Extremely active (intense daily training)",
                nextButton: "Next",
                goalTitle: "Your Goal",
                goalQuestion: "What do you want to achieve?",
                goalMuscleLabel: "Gain muscle",
                goalWeightLossLabel: "Lose weight",
                goalMaintainLabel: "Maintain my weight",
                intensityLabel: "Goal intensity",
                intensityDefault: "Select the intensity",
                intensityLight: "Light (+/- 250 kcal)",
                intensityModerate: "Moderate (+/- 500 kcal)",
                intensityIntense: "Intense (+/- 750 kcal)",
                previousButton: "Previous",
                calculateButton: "Calculate my needs",
                resultsTitle: "Your Nutritional Needs",
                // Suppression du BMR
                imcTitle: "Your Body Mass Index (BMI)",
                imcDescription: "BMI is an indication of your body weight status",
                imcUnderweight: "Underweight",
                imcNormal: "Normal weight",
                imcOverweight: "Overweight",
                imcObesity1: "Obesity class I",
                imcObesity2: "Obesity class II",
                imcObesity3: "Obesity class III",
                tdeeTitle: "Your Total Daily Energy Expenditure (TDEE)",
                tdeeDescription: "Calories needed based on your activity level",
                goalCaloriesTitle: "Recommended calories for your goal",
                macrosTitle: "Macronutrient distribution",
                proteinLabel: "Protein:",
                fatLabel: "Fat:",
                carbsLabel: "Carbs:",
                carbsInfo: "(remaining calories)",
                viewPlanButton: "View my nutrition plan",
                planTitle: "Your Daily Nutrition Plan",
                planDescription: "Based on your needs of",
                restartButton: "Create a new plan",
                savePlanButton: "Save this plan",
                meal: "Meal",
                food: "Food",
                weight: "Weight",
                calories: "Calories",
                nutrition: "Approximate intake",
                breakfast: "Breakfast",
                lunch: "Lunch",
                snack: "Snack",
                dinner: "Dinner",
                total: "Total",
                dailyTotal: "Daily total",
                protein: "Protein",
                carbs: "Carbs",
                fat: "Fat",
                backToHome: "Back to home",
                backToHistory: "Back to history",
                viewHistory: "View history",
                startNewPlan: "Start",
                createFirstPlan: "Create a new plan",
                planSaved: "Plan saved successfully!",
                planDeleted: "Plan deleted successfully!",
                confirmDelete: "Are you sure you want to delete this plan?",
                // Donation
                donationTitle: "Support MarrakFit!",
                donationMessage: "If this nutrition plan has been helpful to you, consider supporting the developer with a small donation. This helps us maintain and improve the application.",
                showPaypalBtn: "Make a donation",
                closeModalBtn: "Later",
                paypalText: "PayPal address for donations:",
                copyButton: "Copy",
                paypalCopied: "PayPal email copied!"
            },
            ar: {
                appTitle: "MarrakFit â€“ Ù…Ø¯Ø±Ø¨ Ø§Ù„Ø³Ø¹Ø±Ø§Øª ÙˆØ§Ù„Ù…Ø§ÙƒØ±Ùˆ Ù…Ù† Ø§Ù„Ù…ØºØ±Ø¨",
                appSubtitle: "Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø®Ø·Ø© ÙˆØ¬Ø¨Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© ÙˆÙÙ‚Ù‹Ø§ Ù„Ø£Ù‡Ø¯Ø§ÙÙƒ",
                currentLanguage: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
                homeTitle: "Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
                newPlanTitle: "Ø®Ø·Ø© Ø¬Ø¯ÙŠØ¯Ø©",
                newPlanDescription: "Ø£Ù†Ø´Ø¦ Ø®Ø·Ø© ØªØºØ°ÙŠØ© Ø´Ø®ØµÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© ÙˆÙÙ‚Ù‹Ø§ Ù„Ø£Ù‡Ø¯Ø§ÙÙƒ",
                historyTitle: "Ø§Ù„Ø³Ø¬Ù„",
                historyDescription: "Ø§Ø·Ù„Ø¹ Ø¹Ù„Ù‰ Ø®Ø·Ø· Ø§Ù„ØªØºØ°ÙŠØ© Ø§Ù„ØªÙŠ Ø£Ù†Ø´Ø£ØªÙ‡Ø§ Ø³Ø§Ø¨Ù‚Ù‹Ø§",
                historyPageTitle: "Ø³Ø¬Ù„ Ø§Ù„Ø®Ø·Ø·",
                emptyHistoryTitle: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø·Ø· Ù…Ø­ÙÙˆØ¸Ø©",
                emptyHistoryDescription: "Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙˆÙ„ Ø®Ø·Ø© ØªØºØ°ÙŠØ© Ù„Ùƒ",
                personalInfoTitle: "Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©",
                ageLabel: "Ø§Ù„Ø¹Ù…Ø±",
                genderLabel: "Ø§Ù„Ø¬Ù†Ø³",
                genderDefault: "Ø§Ø®ØªØ± Ø¬Ù†Ø³Ùƒ",
                genderMale: "Ø±Ø¬Ù„",
                genderFemale: "Ø§Ù…Ø±Ø£Ø©",
                weightLabel: "Ø§Ù„ÙˆØ²Ù† (ÙƒØ¬Ù…)",
                heightLabel: "Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)",
                activityLabel: "Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø´Ø§Ø·",
                activityDefault: "Ø§Ø®ØªØ± Ù…Ø³ØªÙˆÙ‰ Ù†Ø´Ø§Ø·Ùƒ",
                activitySedentary: "Ù‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ© (Ù‚Ù„ÙŠÙ„ Ø£Ùˆ Ø¨Ø¯ÙˆÙ† ØªÙ…Ø§Ø±ÙŠÙ†)",
                activityLight: "Ù†Ø´Ø§Ø· Ø®ÙÙŠÙ (1-3 Ø£ÙŠØ§Ù…/Ø£Ø³Ø¨ÙˆØ¹)",
                activityModerate: "Ù†Ø´Ø§Ø· Ù…Ø¹ØªØ¯Ù„ (3-5 Ø£ÙŠØ§Ù…/Ø£Ø³Ø¨ÙˆØ¹)",
                activityActive: "Ù†Ø´Ø· Ø¬Ø¯Ù‹Ø§ (6-7 Ø£ÙŠØ§Ù…/Ø£Ø³Ø¨ÙˆØ¹)",
                activityExtreme: "Ù†Ø´Ø· Ù„Ù„ØºØ§ÙŠØ© (ØªØ¯Ø±ÙŠØ¨ Ù…ÙƒØ«Ù ÙŠÙˆÙ…ÙŠ)",
                nextButton: "Ø§Ù„ØªØ§Ù„ÙŠ",
                goalTitle: "Ù‡Ø¯ÙÙƒ",
                goalQuestion: "Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªØ­Ù‚Ù‚ØŸ",
                goalMuscleLabel: "Ø§ÙƒØªØ³Ø§Ø¨ Ø§Ù„Ø¹Ø¶Ù„Ø§Øª",
                goalWeightLossLabel: "ÙÙ‚Ø¯Ø§Ù† Ø§Ù„ÙˆØ²Ù†",
                goalMaintainLabel: "Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ ÙˆØ²Ù†ÙŠ",
                intensityLabel: "Ø´Ø¯Ø© Ø§Ù„Ù‡Ø¯Ù",
                intensityDefault: "Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¯Ø©",
                intensityLight: "Ø®ÙÙŠÙ (+/- 250 Ø³Ø¹Ø±Ø©)",
                intensityModerate: "Ù…Ø¹ØªØ¯Ù„ (+/- 500 Ø³Ø¹Ø±Ø©)",
                intensityIntense: "Ù…ÙƒØ«Ù (+/- 750 Ø³Ø¹Ø±Ø©)",
                previousButton: "Ø§Ù„Ø³Ø§Ø¨Ù‚",
                calculateButton: "Ø­Ø³Ø§Ø¨ Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙŠ",
                resultsTitle: "Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙƒ Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ©",
                // Suppression du BMR
                imcTitle: "Ù…Ø¤Ø´Ø± ÙƒØªÙ„Ø© Ø§Ù„Ø¬Ø³Ù… (IMC)",
                imcDescription: "Ù…Ø¤Ø´Ø± ÙƒØªÙ„Ø© Ø§Ù„Ø¬Ø³Ù… Ù‡Ùˆ Ù…Ø¤Ø´Ø± Ù„Ø­Ø§Ù„Ø© ÙˆØ²Ù† Ø¬Ø³Ù…Ùƒ",
                imcUnderweight: "Ù†Ù‚Øµ Ø§Ù„ÙˆØ²Ù†",
                imcNormal: "ÙˆØ²Ù† Ø·Ø¨ÙŠØ¹ÙŠ",
                imcOverweight: "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙˆØ²Ù†",
                imcObesity1: "Ø§Ù„Ø³Ù…Ù†Ø© Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰",
                imcObesity2: "Ø§Ù„Ø³Ù…Ù†Ø© Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©",
                imcObesity3: "Ø§Ù„Ø³Ù…Ù†Ø© Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©",
                tdeeTitle: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¥Ù†ÙØ§Ù‚ Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠ (TDEE)",
                tdeeDescription: "Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ù†Ø´Ø§Ø·Ùƒ",
                goalCaloriesTitle: "Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§ Ù„Ù‡Ø¯ÙÙƒ",
                macrosTitle: "ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØºØ°ÙŠØ§Øª Ø§Ù„ÙƒØ¨Ø±Ù‰",
                proteinLabel: "Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†:",
                fatLabel: "Ø§Ù„Ø¯Ù‡ÙˆÙ†:",
                carbsLabel: "Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª:",
                carbsInfo: "(Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©)",
                viewPlanButton: "Ø¹Ø±Ø¶ Ø®Ø·ØªÙŠ Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ©",
                planTitle: "Ø®Ø·ØªÙƒ Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©",
                planDescription: "Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙƒ Ù…Ù†",
                restartButton: "Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø¬Ø¯ÙŠØ¯Ø©",
                savePlanButton: "Ø­ÙØ¸ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø©",
                meal: "Ø§Ù„ÙˆØ¬Ø¨Ø©",
                food: "Ø§Ù„ØºØ°Ø§Ø¡",
                weight: "Ø§Ù„ÙˆØ²Ù†",
                calories: "Ø§Ù„Ø³Ø¹Ø±Ø§Øª",
                nutrition: "Ø§Ù„Ù…Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ",
                breakfast: "Ø§Ù„Ø¥ÙØ·Ø§Ø±",
                lunch: "Ø§Ù„ØºØ¯Ø§Ø¡",
                snack: "ÙˆØ¬Ø¨Ø© Ø®ÙÙŠÙØ©",
                dinner: "Ø§Ù„Ø¹Ø´Ø§Ø¡",
                total: "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",
                dailyTotal: "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙŠÙˆÙ…ÙŠ",
                protein: "Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†",
                carbs: "Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª",
                fat: "Ø§Ù„Ø¯Ù‡ÙˆÙ†",
                backToHome: "Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
                backToHistory: "Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø¬Ù„",
                viewHistory: "Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„",
                startNewPlan: "Ø¨Ø¯Ø¡",
                createFirstPlan: "Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø¬Ø¯ÙŠØ¯Ø©",
                planSaved: "ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø®Ø·Ø© Ø¨Ù†Ø¬Ø§Ø­!",
                planDeleted: "ØªÙ… Ø­Ø°Ù Ø§Ù„Ø®Ø·Ø© Ø¨Ù†Ø¬Ø§Ø­!",
                confirmDelete: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø©ØŸ",
                // Donation
                donationTitle: "Ø§Ø¯Ø¹Ù… MarrakFit!",
                donationMessage: "Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø®Ø·Ø© Ø§Ù„ØªØºØ°ÙŠØ© Ù‡Ø°Ù‡ Ù…ÙÙŠØ¯Ø© Ù„ÙƒØŒ ÙÙÙƒØ± ÙÙŠ Ø¯Ø¹Ù… Ø§Ù„Ù…Ø·ÙˆØ± Ø¨ØªØ¨Ø±Ø¹ Ø¨Ø³ÙŠØ·. ÙŠØ³Ø§Ø¹Ø¯Ù†Ø§ Ù‡Ø°Ø§ ÙÙŠ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØªØ­Ø³ÙŠÙ†Ù‡.",
                showPaypalBtn: "ØªØ¨Ø±Ø¹ Ø§Ù„Ø¢Ù†",
                closeModalBtn: "Ù„Ø§Ø­Ù‚Ù‹Ø§",
                paypalText: "Ø¹Ù†ÙˆØ§Ù† PayPal Ù„Ù„ØªØ¨Ø±Ø¹Ø§Øª:",
                copyButton: "Ù†Ø³Ø®",
                paypalCopied: "ØªÙ… Ù†Ø³Ø® Ø¨Ø±ÙŠØ¯ PayPal!"
            }
        };

        // Ã‰lÃ©ments DOM
        const homeSection = document.getElementById('homeSection');
        const historySection = document.getElementById('historySection');
        const personalInfoSection = document.getElementById('personalInfoSection');
        const goalSection = document.getElementById('goalSection');
        const resultsSection = document.getElementById('resultsSection');
        const planSection = document.getElementById('planSection');
        const savedPlanSection = document.getElementById('savedPlanSection');
        const stepIndicator = document.getElementById('stepIndicator');
        
        // Boutons de navigation
        const startNewPlanBtn = document.getElementById('startNewPlanBtn');
        const viewHistoryBtn = document.getElementById('viewHistoryBtn');
        const backFromHistoryBtn = document.getElementById('backFromHistoryBtn');
        const backToHomeFromPersonalBtn = document.getElementById('backToHomeFromPersonalBtn');
        const nextToGoalBtn = document.getElementById('nextToGoalBtn');
        const backToPersonalBtn = document.getElementById('backToPersonalBtn');
        const nextToResultsBtn = document.getElementById('nextToResultsBtn');
        const backToGoalBtn = document.getElementById('backToGoalBtn');
        const nextToPlanBtn = document.getElementById('nextToPlanBtn');
        const backToResultsBtn = document.getElementById('backToResultsBtn');
        const savePlanBtn = document.getElementById('savePlanBtn');
        const restartBtn = document.getElementById('restartBtn');
        const backFromSavedPlanBtn = document.getElementById('backFromSavedPlanBtn');
        const backToHistoryFromSavedBtn = document.getElementById('backToHistoryFromSavedBtn');
        const deleteSavedPlanBtn = document.getElementById('deleteSavedPlanBtn');
        const createFirstPlanBtn = document.getElementById('createFirstPlanBtn');
        
        // Ã‰lÃ©ments d'historique
        const historyList = document.getElementById('historyList');
        const emptyHistory = document.getElementById('emptyHistory');
        
        // RÃ©sultats
        const imcResult = document.getElementById('imcResult');
        const tdeeResult = document.getElementById('tdeeResult');
        const goalCaloriesResult = document.getElementById('goalCaloriesResult');
        const goalDescription = document.getElementById('goalDescription');
        const proteinResult = document.getElementById('proteinResult');
        const fatResult = document.getElementById('fatResult');
        const carbsResult = document.getElementById('carbsResult');
        const dailyCaloriesPlan = document.getElementById('dailyCaloriesPlan');
        const planTableContainer = document.getElementById('planTableContainer');
        const proteinInfo = document.getElementById('proteinInfo');
        const fatInfo = document.getElementById('fatInfo');
        
        // Plan sauvegardÃ©
        const savedPersonalInfo = document.getElementById('savedPersonalInfo');
        const savedNutritionalNeeds = document.getElementById('savedNutritionalNeeds');
        const savedPlanTableContainer = document.getElementById('savedPlanTableContainer');
        const savedPlanDate = document.getElementById('savedPlanDate');
        
        // SÃ©lecteur de langue
        const languageBtn = document.getElementById('languageBtn');
        const languageOptions = document.getElementById('languageOptions');
        const currentLanguage = document.getElementById('currentLanguage');
        
        const steps = document.querySelectorAll('.step');
        
        // Don modal elements
        const donationModal = document.getElementById('donationModal');
        const showPaypalBtn = document.getElementById('showPaypalBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const donationInitial = document.getElementById('donationInitial');
        const donationPaypalInfo = document.getElementById('donationPaypalInfo');
        const copyPaypalBtn = document.getElementById('copyPaypalBtn');
        const paypalEmail = document.getElementById('paypalEmail');
        const closePaypalInfoBtn = document.getElementById('closePaypalInfoBtn');
        
        // DonnÃ©es de l'utilisateur
        let userData = {
            age: 0,
            gender: '',
            weight: 0,
            height: 0,
            activityLevel: 0,
            goal: '',
            intensity: 0,
            bmr: 0, // GardÃ© dans l'objet pour le calcul TDEE mais non affichÃ©
            imc: 0, // Ajout de l'IMC
            tdee: 0,
            goalCalories: 0,
            protein: 0,
            fat: 0,
            carbs: 0
        };
        
        // Plan actuellement visualisÃ© (pour la suppression)
        let currentSavedPlanId = null;
        
        // Langue actuelle
        let currentLang = 'fr';
        
        // Structure fixe du plan nutritionnel (adaptatif selon les calories)
        const mealStructure = [
            // Petit-dÃ©jeuner
            { meal: "breakfast", food: "Å’ufs", baseWeight: 150, calories: 210, protein: 18, carbs: 0, fat: 15 },
            { meal: "breakfast", food: "Pain complet", baseWeight: 50, calories: 130, protein: 5, carbs: 25, fat: 2 },
            { meal: "breakfast", food: "Avocat", baseWeight: 50, calories: 80, protein: 0, carbs: 4, fat: 7 },
            { meal: "breakfast", food: "Fruit", baseWeight: 100, calories: 80, protein: 0, carbs: 20, fat: 0 },
            { meal: "breakfast", food: "Huile d'olive", baseWeight: 5, calories: 40, protein: 0, carbs: 0, fat: 5 },
            
            // DÃ©jeuner
            { meal: "lunch", food: "Poulet grillÃ©", baseWeight: 180, calories: 330, protein: 40, carbs: 0, fat: 15 },
            { meal: "lunch", food: "Riz complet cuit", baseWeight: 120, calories: 150, protein: 3, carbs: 35, fat: 0 },
            { meal: "lunch", food: "LÃ©gumes vapeur", baseWeight: 200, calories: 70, protein: 0, carbs: 15, fat: 0 },
            { meal: "lunch", food: "Huile d'olive", baseWeight: 15, calories: 120, protein: 0, carbs: 0, fat: 14 },
            
            // Collation aprÃ¨s-midi
            { meal: "snack", food: "Fruit", baseWeight: 100, calories: 80, protein: 0, carbs: 20, fat: 0 },
            { meal: "snack", food: "Noix", baseWeight: 20, calories: 120, protein: 5, carbs: 0, fat: 12 },
            
            // DÃ®ner
            { meal: "dinner", food: "Poulet grillÃ©", baseWeight: 150, calories: 275, protein: 35, carbs: 0, fat: 12 },
            { meal: "dinner", food: "Riz complet cuit", baseWeight: 100, calories: 130, protein: 2, carbs: 28, fat: 0 },
            { meal: "dinner", food: "Salade verte", baseWeight: 150, calories: 40, protein: 0, carbs: 8, fat: 0 },
            { meal: "dinner", food: "Huile d'olive", baseWeight: 15, calories: 120, protein: 0, carbs: 0, fat: 14 }
        ];
        
        // Ã‰couteurs d'Ã©vÃ©nements
        startNewPlanBtn.addEventListener('click', () => showSection(personalInfoSection));
        viewHistoryBtn.addEventListener('click', showHistory);
        backFromHistoryBtn.addEventListener('click', () => showSection(homeSection));
        backToHomeFromPersonalBtn.addEventListener('click', () => showSection(homeSection));
        nextToGoalBtn.addEventListener('click', goToGoalSection);
        backToPersonalBtn.addEventListener('click', goToPersonalSection);
        nextToResultsBtn.addEventListener('click', goToResultsSection);
        backToGoalBtn.addEventListener('click', backToGoalSection);
        nextToPlanBtn.addEventListener('click', goToPlanSection);
        backToResultsBtn.addEventListener('click', backToResultsSection);
        savePlanBtn.addEventListener('click', savePlan);
        restartBtn.addEventListener('click', restartApp);
        backFromSavedPlanBtn.addEventListener('click', () => showSection(historySection));
        backToHistoryFromSavedBtn.addEventListener('click', () => showSection(historySection));
        deleteSavedPlanBtn.addEventListener('click', deleteSavedPlan);
        createFirstPlanBtn.addEventListener('click', () => showSection(personalInfoSection));

        // Donation Modal Listeners
        showPaypalBtn.addEventListener('click', () => {
            donationInitial.classList.add('hidden');
            donationPaypalInfo.classList.remove('hidden');
        });

        closeModalBtn.addEventListener('click', () => {
            donationModal.style.display = 'none';
        });

        closePaypalInfoBtn.addEventListener('click', () => {
            donationModal.style.display = 'none';
        });

        copyPaypalBtn.addEventListener('click', copyPaypalEmail);
        
        // Gestionnaire de langue
        languageBtn.addEventListener('click', () => {
            languageOptions.classList.toggle('show');
        });
        
        document.querySelectorAll('.language-option').forEach(option => {
            option.addEventListener('click', () => {
                const lang = option.getAttribute('data-lang');
                setLanguage(lang);
                languageOptions.classList.remove('show');
            });
        });
        
        // Navigation entre les sections
        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            stepIndicator.classList.add('hidden');
            
            // Hide donation modal
            donationModal.style.display = 'none';
            donationInitial.classList.remove('hidden');
            donationPaypalInfo.classList.add('hidden');
            
            if (section === homeSection || section === historySection || section === savedPlanSection) {
                // Cacher l'indicateur de progression sur les pages d'accueil et d'historique
                stepIndicator.classList.add('hidden');
            } else {
                // Afficher l'indicateur de progression sur les pages de formulaire
                stepIndicator.classList.remove('hidden');
            }
            
            section.classList.remove('hidden');
            
            // Si on affiche l'historique, mettre Ã  jour la liste
            if (section === historySection) {
                updateHistoryList();
            }
        }
        
        function goToGoalSection() {
            if (!validatePersonalInfo()) return;
            
            personalInfoSection.classList.add('hidden');
            goalSection.classList.remove('hidden');
            updateSteps(2);
        }
        
        function goToPersonalSection() {
            goalSection.classList.add('hidden');
            personalInfoSection.classList.remove('hidden');
            updateSteps(1);
        }
        
        function goToResultsSection() {
            if (!validateGoal()) return;
            
            goalSection.classList.add('hidden');
            resultsSection.classList.remove('hidden');
            calculateResults();
            updateSteps(3);
        }
        
        function backToGoalSection() {
            resultsSection.classList.add('hidden');
            goalSection.classList.remove('hidden');
            updateSteps(2);
        }
        
        function goToPlanSection() {
            resultsSection.classList.add('hidden');
            planSection.classList.remove('hidden');
            generateNutritionPlan();
            updateSteps(4);
            
            // Afficher la modale de don aprÃ¨s 10 secondes
            setTimeout(() => {
                donationModal.style.display = 'flex';
            }, 10000); // 10 secondes
        }
        
        function backToResultsSection() {
            planSection.classList.add('hidden');
            resultsSection.classList.remove('hidden');
            updateSteps(3);
        }
        
        function restartApp() {
            planSection.classList.add('hidden');
            personalInfoSection.classList.remove('hidden');
            document.getElementById('personalInfoForm').reset();
            document.getElementById('goalForm').reset();
            updateSteps(1);
        }
        
        // Mise Ã  jour de l'indicateur de progression
        function updateSteps(activeStep) {
            steps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index + 1 < activeStep) {
                    step.classList.add('completed');
                } else if (index + 1 === activeStep) {
                    step.classList.add('active');
                }
            });
        }
        
        // Validation des informations personnelles
        function validatePersonalInfo() {
            const age = document.getElementById('age').value;
            const gender = document.getElementById('gender').value;
            const weight = document.getElementById('weight').value;
            const height = document.getElementById('height').value;
            const activityLevel = document.getElementById('activityLevel').value;
            
            if (!age || !gender || !weight || !height || !activityLevel) {
                alert(currentLang === 'fr' ? 'Veuillez remplir tous les champs' : 
                      currentLang === 'en' ? 'Please fill in all fields' : 
                      'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return false;
            }
            
            userData.age = parseInt(age);
            userData.gender = gender;
            userData.weight = parseFloat(weight);
            userData.height = parseInt(height);
            userData.activityLevel = parseFloat(activityLevel);
            
            return true;
        }
        
        // Validation de l'objectif
        function validateGoal() {
            const goal = document.querySelector('input[name="goal"]:checked');
            const intensity = document.getElementById('intensity').value;
            
            if (!goal || !intensity) {
                alert(currentLang === 'fr' ? 'Veuillez sÃ©lectionner un objectif et une intensitÃ©' : 
                      currentLang === 'en' ? 'Please select a goal and intensity' : 
                      'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù‡Ø¯Ù ÙˆØ´Ø¯Ø©');
                return false;
            }
            
            userData.goal = goal.value;
            userData.intensity = parseInt(intensity);
            
            return true;
        }
        
        // Calcul des rÃ©sultats avec les nouvelles rÃ¨gles de protÃ©ines et lipides
        function calculateResults() {
            // Calcul du BMR (MÃ©tabolisme de base) - non affichÃ©
            if (userData.gender === 'male') {
                userData.bmr = 10 * userData.weight + 6.25 * userData.height - 5 * userData.age + 5;
            } else {
                userData.bmr = 10 * userData.weight + 6.25 * userData.height - 5 * userData.age - 161;
            }

            // Calcul de l'IMC (Indice de Masse Corporelle)
            const heightMeters = userData.height / 100;
            userData.imc = parseFloat((userData.weight / (heightMeters * heightMeters)).toFixed(1));
            
            // Calcul du TDEE (DÃ©pense Ã©nergÃ©tique totale)
            userData.tdee = Math.round(userData.bmr * userData.activityLevel);
            
            // Calcul des calories selon l'objectif
            if (userData.goal === 'muscle') {
                userData.goalCalories = Math.round(userData.tdee + userData.intensity);
                goalDescription.textContent = currentLang === 'fr' ? 
                    `Pour prendre du muscle, vous devez consommer ${userData.intensity} calories de plus que votre dÃ©pense Ã©nergÃ©tique.` :
                    currentLang === 'en' ?
                    `To gain muscle, you need to consume ${userData.intensity} calories more than your energy expenditure.` :
                    `Ù„Ø§ÙƒØªØ³Ø§Ø¨ Ø§Ù„Ø¹Ø¶Ù„Ø§ØªØŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ ${userData.intensity} Ø³Ø¹Ø±Ø© Ø­Ø±Ø§Ø±ÙŠØ© Ø£ÙƒØ«Ø± Ù…Ù† Ø¥Ù†ÙØ§Ù‚Ùƒ Ù„Ù„Ø·Ø§Ù‚Ø©.`;
            } else if (userData.goal === 'weightLoss') {
                userData.goalCalories = Math.round(userData.tdee - userData.intensity);
                goalDescription.textContent = currentLang === 'fr' ? 
                    `Pour perdre du poids, vous devez consommer ${userData.intensity} calories de moins que votre dÃ©pense Ã©nergÃ©tique.` :
                    currentLang === 'en' ?
                    `To lose weight, you need to consume ${userData.intensity} calories less than your energy expenditure.` :
                    `Ù„ÙÙ‚Ø¯Ø§Ù† Ø§Ù„ÙˆØ²Ù†ØŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ ${userData.intensity} Ø³Ø¹Ø±Ø© Ø­Ø±Ø§Ø±ÙŠØ© Ø£Ù‚Ù„ Ù…Ù† Ø¥Ù†ÙØ§Ù‚Ùƒ Ù„Ù„Ø·Ø§Ù‚Ø©.`;
            } else {
                userData.goalCalories = Math.round(userData.tdee);
                goalDescription.textContent = currentLang === 'fr' ? 
                    `Pour maintenir votre poids, vous devez consommer l'Ã©quivalent de votre dÃ©pense Ã©nergÃ©tique.` :
                    currentLang === 'en' ?
                    `To maintain your weight, you need to consume the equivalent of your energy expenditure.` :
                    `Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ ÙˆØ²Ù†ÙƒØŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ù…Ø§ ÙŠØ¹Ø§Ø¯Ù„ Ø¥Ù†ÙØ§Ù‚Ùƒ Ù„Ù„Ø·Ø§Ù‚Ø©.`;
            }
            
            // Calcul des protÃ©ines selon les nouvelles rÃ¨gles
            if (userData.goal === 'muscle') {
                userData.protein = userData.gender === 'male' ? 
                    Math.round(userData.weight * 1.5) : 
                    Math.round(userData.weight * 1.2);
                proteinInfo.textContent = userData.gender === 'male' ? 
                    "(1.5g par kg de poids)" : "(1.2g par kg de poids)";
            } else if (userData.goal === 'weightLoss') {
                userData.protein = userData.gender === 'male' ? 
                    Math.round(userData.weight * 2) : 
                    Math.round(userData.weight * 1.5);
                proteinInfo.textContent = userData.gender === 'male' ? 
                    "(2g par kg de poids)" : "(1.5g par kg de poids)";
            } else {
                userData.protein = Math.round(userData.weight * 1.2);
                proteinInfo.textContent = "(1.2g par kg de poids)";
            }
            
            // Calcul des lipides selon les nouvelles rÃ¨gles
            if (userData.goal === 'muscle') {
                userData.fat = Math.round(userData.weight * 1);
                fatInfo.textContent = "(1g par kg de poids)";
            } else if (userData.goal === 'weightLoss') {
                userData.fat = userData.gender === 'male' ? 
                    Math.round(userData.weight * 0.7) : 
                    Math.round(userData.weight * 0.8);
                fatInfo.textContent = userData.gender === 'male' ? 
                    "(0.7g par kg de poids)" : "(0.8g par kg de poids)";
            } else {
                userData.fat = Math.round(userData.weight * 1);
                fatInfo.textContent = "(1g par kg de poids)";
            }
            
            // Les glucides reprÃ©sentent le reste des calories
            const proteinCalories = userData.protein * 4;
            const fatCalories = userData.fat * 9;
            const remainingCalories = userData.goalCalories - proteinCalories - fatCalories;
            userData.carbs = Math.max(0, Math.round(remainingCalories / 4));
            
            // Affichage des rÃ©sultats
            
            // IMC Display
            const { status: imcStatus, emoji: imcEmoji } = getImcStatus(userData.imc);
            imcResult.innerHTML = `${userData.imc} <span>${imcEmoji} (${imcStatus})</span>`;
            
            tdeeResult.textContent = `${userData.tdee} ${currentLang === 'fr' ? 'calories' : currentLang === 'en' ? 'calories' : 'Ø³Ø¹Ø±Ø©'}`;
            goalCaloriesResult.textContent = `${userData.goalCalories} ${currentLang === 'fr' ? 'calories' : currentLang === 'en' ? 'calories' : 'Ø³Ø¹Ø±Ø©'}`;
            proteinResult.textContent = `${userData.protein}g`;
            fatResult.textContent = `${userData.fat}g`;
            carbsResult.textContent = `${userData.carbs}g`;
            
            dailyCaloriesPlan.textContent = userData.goalCalories;
        }

        // Fonction de statut IMC
        function getImcStatus(imc) {
            let status = '';
            let emoji = '';
            if (imc < 18.5) {
                status = translations[currentLang].imcUnderweight;
                emoji = 'ğŸ˜”';
            } else if (imc >= 18.5 && imc < 25) {
                status = translations[currentLang].imcNormal;
                emoji = 'ğŸ‘';
            } else if (imc >= 25 && imc < 30) {
                status = translations[currentLang].imcOverweight;
                emoji = 'âš ï¸';
            } else if (imc >= 30 && imc < 35) {
                status = translations[currentLang].imcObesity1;
                emoji = 'ğŸš¨';
            } else if (imc >= 35 && imc < 40) {
                status = translations[currentLang].imcObesity2;
                emoji = 'ğŸ”¥';
            } else {
                status = translations[currentLang].imcObesity3;
                emoji = 'ğŸ›‘';
            }
            return { status, emoji };
        }
        
        // GÃ©nÃ©ration du plan nutritionnel adaptatif avec totaux
        function generateNutritionPlan() {
            planTableContainer.innerHTML = '';
            
            // Facteur d'ajustement selon les calories totales
            const baseCalories = 2000; // Calories de rÃ©fÃ©rence du plan de base
            const adjustmentFactor = userData.goalCalories / baseCalories;
            
            // CrÃ©er le tableau
            const table = document.createElement('table');
            table.className = 'plan-table';
            
            // En-tÃªte du tableau
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            
            const headers = [
                translations[currentLang].meal,
                translations[currentLang].food,
                translations[currentLang].weight,
                translations[currentLang].calories,
                translations[currentLang].nutrition
            ];
            
            headers.forEach(headerText => {
                const th = document.createElement('th');
                th.textContent = headerText;
                headerRow.appendChild(th);
            });
            
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // Corps du tableau
            const tbody = document.createElement('tbody');
            
            // Variables pour les totaux
            let currentMeal = '';
            let mealCalories = 0;
            let mealProtein = 0;
            let mealCarbs = 0;
            let mealFat = 0;
            
            let dailyCalories = 0;
            let dailyProtein = 0;
            let dailyCarbs = 0;
            let dailyFat = 0;
            
            mealStructure.forEach((item, index) => {
                // Si on change de repas, ajouter la ligne de total du repas prÃ©cÃ©dent
                if (currentMeal !== '' && currentMeal !== item.meal) {
                    addMealTotalRow(currentMeal, mealCalories, mealProtein, mealCarbs, mealFat);
                    
                    // RÃ©initialiser les totaux du repas
                    mealCalories = 0;
                    mealProtein = 0;
                    mealCarbs = 0;
                    mealFat = 0;
                }
                
                // Si c'est le dÃ©but d'un nouveau repas, ajouter l'en-tÃªte du repas
                if (currentMeal !== item.meal) {
                    currentMeal = item.meal;
                    
                    const mealHeaderRow = document.createElement('tr');
                    mealHeaderRow.className = 'meal-header';
                    
                    const mealHeaderCell = document.createElement('td');
                    mealHeaderCell.colSpan = 5;
                    mealHeaderCell.textContent = translations[currentLang][item.meal];
                    mealHeaderRow.appendChild(mealHeaderCell);
                    
                    tbody.appendChild(mealHeaderRow);
                }
                
                // Ajuster la quantitÃ© selon les calories nÃ©cessaires
                const adjustedWeight = Math.round(item.baseWeight * adjustmentFactor);
                const adjustedCalories = Math.round(item.calories * adjustmentFactor);
                const adjustedProtein = Math.round(item.protein * adjustmentFactor);
                const adjustedCarbs = Math.round(item.carbs * adjustmentFactor);
                const adjustedFat = Math.round(item.fat * adjustmentFactor);
                
                // Ajouter les valeurs aux totaux
                mealCalories += adjustedCalories;
                mealProtein += adjustedProtein;
                mealCarbs += adjustedCarbs;
                mealFat += adjustedFat;
                
                dailyCalories += adjustedCalories;
                dailyProtein += adjustedProtein;
                dailyCarbs += adjustedCarbs;
                dailyFat += adjustedFat;
                
                // Ligne de l'aliment
                const row = document.createElement('tr');
                
                // Colonne Repas (vide car fusionnÃ©e)
                const mealCell = document.createElement('td');
                mealCell.textContent = '';
                row.appendChild(mealCell);
                
                // Colonne Aliment
                const foodCell = document.createElement('td');
                foodCell.textContent = item.food;
                row.appendChild(foodCell);
                
                // Colonne Poids
                const weightCell = document.createElement('td');
                weightCell.textContent = `${adjustedWeight}g`;
                row.appendChild(weightCell);
                
                // Colonne Calories
                const caloriesCell = document.createElement('td');
                caloriesCell.textContent = `${adjustedCalories} kcal`;
                row.appendChild(caloriesCell);
                
                // Colonne Apports nutritionnels
                const nutritionCell = document.createElement('td');
                let nutritionText = '';
                
                if (adjustedProtein > 0) {
                    nutritionText += `${translations[currentLang].protein} ${adjustedProtein}g`;
                }
                if (adjustedCarbs > 0) {
                    if (nutritionText) nutritionText += ', ';
                    nutritionText += `${translations[currentLang].carbs} ${adjustedCarbs}g`;
                }
                if (adjustedFat > 0) {
                    if (nutritionText) nutritionText += ', ';
                    nutritionText += `${translations[currentLang].fat} ${adjustedFat}g`;
                }
                
                nutritionCell.textContent = nutritionText;
                row.appendChild(nutritionCell);
                
                tbody.appendChild(row);
                
                // Si c'est le dernier aliment, ajouter le total du repas
                if (index === mealStructure.length - 1) {
                    addMealTotalRow(currentMeal, mealCalories, mealProtein, mealCarbs, mealFat);
                }
            });
            
            // Fonction pour ajouter une ligne de total de repas
            function addMealTotalRow(meal, calories, protein, carbs, fat) {
                const totalRow = document.createElement('tr');
                totalRow.className = 'meal-total-row';
                
                const totalCell = document.createElement('td');
                totalCell.colSpan = 2;
                totalCell.textContent = `${translations[currentLang][meal]} - ${translations[currentLang].total}`;
                totalRow.appendChild(totalCell);
                
                const emptyCell = document.createElement('td');
                emptyCell.textContent = '';
                totalRow.appendChild(emptyCell);
                
                const caloriesCell = document.createElement('td');
                caloriesCell.textContent = `${calories} kcal`;
                totalRow.appendChild(caloriesCell);
                
                const nutritionCell = document.createElement('td');
                let nutritionText = '';
                
                if (protein > 0) nutritionText += `${translations[currentLang].protein} ${protein}g`;
                if (carbs > 0) nutritionText += (nutritionText ? ', ' : '') + `${translations[currentLang].carbs} ${carbs}g`;
                if (fat > 0) nutritionText += (nutritionText ? ', ' : '') + `${translations[currentLang].fat} ${fat}g`;
                
                nutritionCell.textContent = nutritionText;
                totalRow.appendChild(nutritionCell);
                
                tbody.appendChild(totalRow);
            }
            
            // Ajouter la ligne de total quotidien
            const dailyTotalRow = document.createElement('tr');
            dailyTotalRow.className = 'daily-total-row';
            
            const dailyTotalCell = document.createElement('td');
            dailyTotalCell.colSpan = 2;
            dailyTotalCell.textContent = translations[currentLang].dailyTotal;
            dailyTotalRow.appendChild(dailyTotalCell);
            
            const emptyCell = document.createElement('td');
            emptyCell.textContent = '';
            dailyTotalRow.appendChild(emptyCell);
            
            const dailyCaloriesCell = document.createElement('td');
            dailyCaloriesCell.textContent = `${dailyCalories} kcal`;
            dailyTotalRow.appendChild(dailyCaloriesCell);
            
            const dailyNutritionCell = document.createElement('td');
            let dailyNutritionText = '';
            
            if (dailyProtein > 0) dailyNutritionText += `${translations[currentLang].protein} ${dailyProtein}g`;
            if (dailyCarbs > 0) dailyNutritionText += (dailyNutritionText ? ', ' : '') + `${translations[currentLang].carbs} ${dailyCarbs}g`;
            if (dailyFat > 0) dailyNutritionText += (dailyNutritionText ? ', ' : '') + `${translations[currentLang].fat} ${dailyFat}g`;
            
            dailyNutritionCell.textContent = dailyNutritionText;
            dailyTotalRow.appendChild(dailyNutritionCell);
            
            tbody.appendChild(dailyTotalRow);
            
            table.appendChild(tbody);
            planTableContainer.appendChild(table);
        }
        
        // Sauvegarde du plan dans le localStorage
        function savePlan() {
            const planData = {
                id: Date.now().toString(),
                date: new Date().toLocaleString(currentLang === 'fr' ? 'fr-FR' : currentLang === 'en' ? 'en-US' : 'ar-MA'),
                userData: { ...userData },
                planTable: planTableContainer.innerHTML
            };
            
            // RÃ©cupÃ©rer les plans existants
            const savedPlans = JSON.parse(localStorage.getItem('marrakfit_plans') || '[]');
            
            // Ajouter le nouveau plan
            savedPlans.unshift(planData);
            
            // Sauvegarder dans le localStorage
            localStorage.setItem('marrakfit_plans', JSON.stringify(savedPlans));
            
            alert(translations[currentLang].planSaved);
        }
        
        // Affichage de l'historique
        function showHistory() {
            showSection(historySection);
            updateHistoryList();
        }
        
        // Mise Ã  jour de la liste d'historique
        function updateHistoryList() {
            const savedPlans = JSON.parse(localStorage.getItem('marrakfit_plans') || '[]');
            
            historyList.innerHTML = '';
            
            if (savedPlans.length === 0) {
                emptyHistory.classList.remove('hidden');
                historyList.classList.add('hidden');
            } else {
                emptyHistory.classList.add('hidden');
                historyList.classList.remove('hidden');
                
                savedPlans.forEach(plan => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.addEventListener('click', () => viewSavedPlan(plan));
                    
                    historyItem.innerHTML = `
                        <div class="history-item-header">
                            <div class="history-item-title">Plan nutritionnel</div>
                            <div class="history-item-date">${plan.date}</div>
                        </div>
                        <div class="history-item-details">
                            <div class="history-detail">
                                <span class="history-detail-label">Calories</span>
                                <span class="history-detail-value">${plan.userData.goalCalories} kcal</span>
                            </div>
                            <div class="history-detail">
                                <span class="history-detail-label">Objectif</span>
                                <span class="history-detail-value">${getGoalLabel(plan.userData.goal)}</span>
                            </div>
                            <div class="history-detail">
                                <span class="history-detail-label">ProtÃ©ines</span>
                                <span class="history-detail-value">${plan.userData.protein}g</span>
                            </div>
                        </div>
                    `;
                    
                    historyList.appendChild(historyItem);
                });
            }
        }
        
        // Affichage d'un plan sauvegardÃ©
        function viewSavedPlan(plan) {
            currentSavedPlanId = plan.id;
            
            // Mettre Ã  jour les informations du plan
            savedPlanDate.textContent = `${translations[currentLang].planTitle} - ${plan.date}`;
            
            // Afficher les informations personnelles
            savedPersonalInfo.innerHTML = `
                <p><strong>Ã‚ge:</strong> ${plan.userData.age} ans</p>
                <p><strong>Genre:</strong> ${plan.userData.gender === 'male' ? translations[currentLang].genderMale : translations[currentLang].genderFemale}</p>
                <p><strong>Poids:</strong> ${plan.userData.weight} kg</p>
                <p><strong>Taille:</strong> ${plan.userData.height} cm</p>
                <p><strong>Niveau d'activitÃ©:</strong> ${getActivityLevelLabel(plan.userData.activityLevel)}</p>
            `;
            
            // Afficher les besoins nutritionnels
            const { status: imcStatus, emoji: imcEmoji } = getImcStatus(plan.userData.imc);
            savedNutritionalNeeds.innerHTML = `
                <p><strong>IMC:</strong> ${plan.userData.imc} ${imcEmoji} (${imcStatus})</p>
                <p><strong>TDEE:</strong> ${Math.round(plan.userData.tdee)} calories</p>
                <p><strong>Calories recommandÃ©es:</strong> ${plan.userData.goalCalories} calories</p>
                <p><strong>ProtÃ©ines:</strong> ${plan.userData.protein}g</p>
                <p><strong>Lipides:</strong> ${plan.userData.fat}g</p>
                <p><strong>Glucides:</strong> ${plan.userData.carbs}g</p>
            `;
            
            // Afficher le tableau du plan
            savedPlanTableContainer.innerHTML = plan.planTable;
            
            showSection(savedPlanSection);
        }
        
        // Suppression d'un plan sauvegardÃ©
        function deleteSavedPlan() {
            if (!currentSavedPlanId) return;
            
            if (confirm(translations[currentLang].confirmDelete)) {
                const savedPlans = JSON.parse(localStorage.getItem('marrakfit_plans') || '[]');
                const updatedPlans = savedPlans.filter(plan => plan.id !== currentSavedPlanId);
                
                localStorage.setItem('marrakfit_plans', JSON.stringify(updatedPlans));
                
                alert(translations[currentLang].planDeleted);
                showHistory();
            }
        }

        // Fonction de copie de l'email PayPal
        function copyPaypalEmail() {
            const email = paypalEmail.textContent;
            navigator.clipboard.writeText(email).then(() => {
                alert(translations[currentLang].paypalCopied);
            }).catch(err => {
                console.error('Erreur lors de la copie: ', err);
            });
        }
        
        // Fonctions utilitaires pour les labels
        function getGoalLabel(goal) {
            switch(goal) {
                case 'muscle': return translations[currentLang].goalMuscleLabel;
                case 'weightLoss': return translations[currentLang].goalWeightLossLabel;
                case 'maintain': return translations[currentLang].goalMaintainLabel;
                default: return goal;
            }
        }
        
        function getActivityLevelLabel(activityLevel) {
            switch(activityLevel) {
                case 1.2: return translations[currentLang].activitySedentary;
                case 1.375: return translations[currentLang].activityLight;
                case 1.55: return translations[currentLang].activityModerate;
                case 1.725: return translations[currentLang].activityActive;
                case 1.9: return translations[currentLang].activityExtreme;
                default: return activityLevel;
            }
        }
        
        // Changer la langue de l'application
        function setLanguage(lang) {
            currentLang = lang;
            currentLanguage.textContent = translations[lang].currentLanguage;
            
            // Mettre Ã  jour tous les textes de l'interface
            for (const key in translations[lang]) {
                const element = document.getElementById(key);
                if (element) {
                    // Pour les options de sÃ©lection (select), seul le texte doit Ãªtre mis Ã  jour
                    if (element.tagName === 'OPTION' || element.tagName === 'LABEL') {
                         element.textContent = translations[lang][key];
                    } else if (element.tagName === 'BUTTON') {
                        // Les boutons de l'interface principale ont dÃ©jÃ  leur texte gÃ©rÃ© par leur ID
                        // On gÃ¨re spÃ©cifiquement les boutons de la modale de don si leur ID est dans la traduction
                         if (key === 'showPaypalBtn' || key === 'closeModalBtn' || key === 'copyPaypalBtn') {
                            element.textContent = translations[lang][key];
                        }
                    } else if (element.tagName !== 'INPUT' && element.tagName !== 'SELECT' && element.id !== 'paypalEmail') {
                        // Mettre Ã  jour le texte des Ã©lÃ©ments standards
                         element.textContent = translations[lang][key];
                    }
                }
            }
            
            // Mettre Ã  jour les textes des boutons principaux (si leur ID n'est pas dans translations)
            document.getElementById('startNewPlanBtn').textContent = translations[lang].startNewPlan;
            document.getElementById('viewHistoryBtn').textContent = translations[lang].viewHistory;
            document.getElementById('backFromHistoryBtn').textContent = `â† ${translations[lang].backToHome}`;
            document.getElementById('backToHomeFromPersonalBtn').textContent = translations[lang].backToHome;
            document.getElementById('nextToGoalBtn').textContent = translations[lang].nextButton;
            document.getElementById('backToPersonalBtn').textContent = translations[lang].previousButton;
            document.getElementById('nextToResultsBtn').textContent = translations[lang].calculateButton;
            document.getElementById('backToGoalBtn').textContent = translations[lang].previousButton;
            document.getElementById('nextToPlanBtn').textContent = translations[lang].viewPlanButton;
            document.getElementById('backToResultsBtn').textContent = translations[lang].previousButton;
            document.getElementById('savePlanBtn').textContent = translations[lang].savePlanButton;
            document.getElementById('restartBtn').textContent = translations[lang].restartButton;
            document.getElementById('backFromSavedPlanBtn').textContent = `â† ${translations[lang].backToHistory}`;
            document.getElementById('backToHistoryFromSavedBtn').textContent = translations[lang].backToHistory;
            document.getElementById('deleteSavedPlanBtn').textContent = translations[lang].deleteSavedPlan;
            document.getElementById('createFirstPlanBtn').textContent = translations[lang].createFirstPlan;


            // Si nous sommes sur la page des rÃ©sultats, recalculer pour mettre Ã  jour les textes
            if (!resultsSection.classList.contains('hidden')) {
                calculateResults();
            }
            
            // Si nous sommes sur la page du plan, regÃ©nÃ©rer le plan
            if (!planSection.classList.contains('hidden')) {
                generateNutritionPlan();
            }
            
            // Si nous sommes sur la page d'historique, mettre Ã  jour la liste
            if (!historySection.classList.contains('hidden')) {
                updateHistoryList();
            }

             // Si nous sommes sur la vue dÃ©taillÃ©e d'un plan sauvegardÃ©, mettre Ã  jour
            if (!savedPlanSection.classList.contains('hidden') && currentSavedPlanId) {
                const savedPlans = JSON.parse(localStorage.getItem('marrakfit_plans') || '[]');
                const currentPlan = savedPlans.find(p => p.id === currentSavedPlanId);
                if (currentPlan) {
                     viewSavedPlan(currentPlan); // Re-affiche le plan avec la nouvelle langue
                }
            }
            
            // Ajuster la direction du texte pour l'arabe
            if (lang === 'ar') {
                document.body.style.direction = 'rtl';
                document.body.style.textAlign = 'right';
                document.querySelectorAll('.plan-table th, .plan-table td').forEach(el => el.style.textAlign = 'right');
            } else {
                document.body.style.direction = 'ltr';
                document.body.style.textAlign = 'left';
                document.querySelectorAll('.plan-table th, .plan-table td').forEach(el => el.style.textAlign = 'left');
            }
        }
        
        // Initialisation
        updateSteps(1);
        setLanguage('fr'); // Langue par dÃ©faut
    </script>
</body>
</html>
